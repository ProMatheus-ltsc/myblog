<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微服务部署 | MyBlog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="包含: Java 基础, JVM, Spring, Spring Boot, Spring Cloud, MySQL, MongoDB, k8s, Linux, DevOps, 分布式,  开发工具, Git...">
    
    <link rel="preload" href="/matheusblog/assets/css/0.styles.980a01be.css" as="style"><link rel="preload" href="/matheusblog/assets/js/app.617ede8e.js" as="script"><link rel="preload" href="/matheusblog/assets/js/3.1edc7715.js" as="script"><link rel="preload" href="/matheusblog/assets/js/98.ba771394.js" as="script"><link rel="prefetch" href="/matheusblog/assets/js/10.a4274951.js"><link rel="prefetch" href="/matheusblog/assets/js/100.78fe1758.js"><link rel="prefetch" href="/matheusblog/assets/js/101.271b4567.js"><link rel="prefetch" href="/matheusblog/assets/js/102.02ed277a.js"><link rel="prefetch" href="/matheusblog/assets/js/103.4a9e6979.js"><link rel="prefetch" href="/matheusblog/assets/js/104.d4e0978d.js"><link rel="prefetch" href="/matheusblog/assets/js/105.765ba1c6.js"><link rel="prefetch" href="/matheusblog/assets/js/106.dd6a8cf7.js"><link rel="prefetch" href="/matheusblog/assets/js/107.a48ee336.js"><link rel="prefetch" href="/matheusblog/assets/js/108.881d0a0f.js"><link rel="prefetch" href="/matheusblog/assets/js/109.66cdcf04.js"><link rel="prefetch" href="/matheusblog/assets/js/11.1b6c8655.js"><link rel="prefetch" href="/matheusblog/assets/js/110.957d4c09.js"><link rel="prefetch" href="/matheusblog/assets/js/111.1d0b487a.js"><link rel="prefetch" href="/matheusblog/assets/js/112.a61fcb29.js"><link rel="prefetch" href="/matheusblog/assets/js/113.b6351067.js"><link rel="prefetch" href="/matheusblog/assets/js/114.13d5d68a.js"><link rel="prefetch" href="/matheusblog/assets/js/115.96e1a960.js"><link rel="prefetch" href="/matheusblog/assets/js/116.b57527a1.js"><link rel="prefetch" href="/matheusblog/assets/js/117.750289c2.js"><link rel="prefetch" href="/matheusblog/assets/js/118.7c7f28cd.js"><link rel="prefetch" href="/matheusblog/assets/js/119.7debf7c1.js"><link rel="prefetch" href="/matheusblog/assets/js/12.567832f0.js"><link rel="prefetch" href="/matheusblog/assets/js/120.7db39b5e.js"><link rel="prefetch" href="/matheusblog/assets/js/121.f91dcbd4.js"><link rel="prefetch" href="/matheusblog/assets/js/122.a4b16326.js"><link rel="prefetch" href="/matheusblog/assets/js/123.040a1747.js"><link rel="prefetch" href="/matheusblog/assets/js/124.ed8dcf7b.js"><link rel="prefetch" href="/matheusblog/assets/js/125.5eaa8d63.js"><link rel="prefetch" href="/matheusblog/assets/js/126.c744fa8f.js"><link rel="prefetch" href="/matheusblog/assets/js/127.1e5cefbc.js"><link rel="prefetch" href="/matheusblog/assets/js/128.b1fe1688.js"><link rel="prefetch" href="/matheusblog/assets/js/129.8204d33f.js"><link rel="prefetch" href="/matheusblog/assets/js/13.91e053cb.js"><link rel="prefetch" href="/matheusblog/assets/js/130.8c474790.js"><link rel="prefetch" href="/matheusblog/assets/js/131.9841107b.js"><link rel="prefetch" href="/matheusblog/assets/js/132.85478469.js"><link rel="prefetch" href="/matheusblog/assets/js/133.f07173f3.js"><link rel="prefetch" href="/matheusblog/assets/js/134.ee3ce9ee.js"><link rel="prefetch" href="/matheusblog/assets/js/135.8eb9be80.js"><link rel="prefetch" href="/matheusblog/assets/js/136.7878e4c4.js"><link rel="prefetch" href="/matheusblog/assets/js/137.258d15b4.js"><link rel="prefetch" href="/matheusblog/assets/js/138.1927fb45.js"><link rel="prefetch" href="/matheusblog/assets/js/139.7a4d778f.js"><link rel="prefetch" href="/matheusblog/assets/js/14.9285be11.js"><link rel="prefetch" href="/matheusblog/assets/js/140.99cc4317.js"><link rel="prefetch" href="/matheusblog/assets/js/141.4b56260d.js"><link rel="prefetch" href="/matheusblog/assets/js/142.df51a8d2.js"><link rel="prefetch" href="/matheusblog/assets/js/143.e2efcc1f.js"><link rel="prefetch" href="/matheusblog/assets/js/144.dc1912f0.js"><link rel="prefetch" href="/matheusblog/assets/js/145.1974ebf1.js"><link rel="prefetch" href="/matheusblog/assets/js/146.4c67ea48.js"><link rel="prefetch" href="/matheusblog/assets/js/147.8a045d86.js"><link rel="prefetch" href="/matheusblog/assets/js/148.12d59657.js"><link rel="prefetch" href="/matheusblog/assets/js/149.1068887b.js"><link rel="prefetch" href="/matheusblog/assets/js/15.ad7b78bc.js"><link rel="prefetch" href="/matheusblog/assets/js/150.99ded28f.js"><link rel="prefetch" href="/matheusblog/assets/js/151.98271ce0.js"><link rel="prefetch" href="/matheusblog/assets/js/152.bee3b186.js"><link rel="prefetch" href="/matheusblog/assets/js/153.d968ced2.js"><link rel="prefetch" href="/matheusblog/assets/js/154.3b28d6c6.js"><link rel="prefetch" href="/matheusblog/assets/js/155.54857e2f.js"><link rel="prefetch" href="/matheusblog/assets/js/156.d28705f4.js"><link rel="prefetch" href="/matheusblog/assets/js/157.741b282e.js"><link rel="prefetch" href="/matheusblog/assets/js/158.a7b4f565.js"><link rel="prefetch" href="/matheusblog/assets/js/159.d1603e9f.js"><link rel="prefetch" href="/matheusblog/assets/js/16.3a834051.js"><link rel="prefetch" href="/matheusblog/assets/js/160.437df2dc.js"><link rel="prefetch" href="/matheusblog/assets/js/161.ee1663cc.js"><link rel="prefetch" href="/matheusblog/assets/js/162.a4269c74.js"><link rel="prefetch" href="/matheusblog/assets/js/163.6dfc84ae.js"><link rel="prefetch" href="/matheusblog/assets/js/164.479dd92c.js"><link rel="prefetch" href="/matheusblog/assets/js/165.a40f67ef.js"><link rel="prefetch" href="/matheusblog/assets/js/166.f9929e55.js"><link rel="prefetch" href="/matheusblog/assets/js/167.83c3bb62.js"><link rel="prefetch" href="/matheusblog/assets/js/168.c191e98e.js"><link rel="prefetch" href="/matheusblog/assets/js/169.82f873a1.js"><link rel="prefetch" href="/matheusblog/assets/js/17.0ccca805.js"><link rel="prefetch" href="/matheusblog/assets/js/170.23ddbe8d.js"><link rel="prefetch" href="/matheusblog/assets/js/171.4b3301e2.js"><link rel="prefetch" href="/matheusblog/assets/js/172.2598c8af.js"><link rel="prefetch" href="/matheusblog/assets/js/173.5609a415.js"><link rel="prefetch" href="/matheusblog/assets/js/174.047b650b.js"><link rel="prefetch" href="/matheusblog/assets/js/175.e93b2ffb.js"><link rel="prefetch" href="/matheusblog/assets/js/176.c70eee1f.js"><link rel="prefetch" href="/matheusblog/assets/js/177.cc67f45b.js"><link rel="prefetch" href="/matheusblog/assets/js/178.c8cdac54.js"><link rel="prefetch" href="/matheusblog/assets/js/179.065ab189.js"><link rel="prefetch" href="/matheusblog/assets/js/18.8acc3a07.js"><link rel="prefetch" href="/matheusblog/assets/js/180.f4bbed6c.js"><link rel="prefetch" href="/matheusblog/assets/js/181.f06d18b3.js"><link rel="prefetch" href="/matheusblog/assets/js/182.2266e036.js"><link rel="prefetch" href="/matheusblog/assets/js/183.8bae6e52.js"><link rel="prefetch" href="/matheusblog/assets/js/184.ced1d65a.js"><link rel="prefetch" href="/matheusblog/assets/js/185.496443a5.js"><link rel="prefetch" href="/matheusblog/assets/js/186.afd0d5e5.js"><link rel="prefetch" href="/matheusblog/assets/js/187.e5b8440c.js"><link rel="prefetch" href="/matheusblog/assets/js/188.f2974407.js"><link rel="prefetch" href="/matheusblog/assets/js/189.42b1e557.js"><link rel="prefetch" href="/matheusblog/assets/js/19.7395ddb6.js"><link rel="prefetch" href="/matheusblog/assets/js/190.7eb67e41.js"><link rel="prefetch" href="/matheusblog/assets/js/191.a468322e.js"><link rel="prefetch" href="/matheusblog/assets/js/192.9c4aed4c.js"><link rel="prefetch" href="/matheusblog/assets/js/193.31d2189a.js"><link rel="prefetch" href="/matheusblog/assets/js/194.4f7ab834.js"><link rel="prefetch" href="/matheusblog/assets/js/195.0d492f64.js"><link rel="prefetch" href="/matheusblog/assets/js/196.aeeada4e.js"><link rel="prefetch" href="/matheusblog/assets/js/197.57a41525.js"><link rel="prefetch" href="/matheusblog/assets/js/198.8193c212.js"><link rel="prefetch" href="/matheusblog/assets/js/199.122c79ea.js"><link rel="prefetch" href="/matheusblog/assets/js/2.e4dcb666.js"><link rel="prefetch" href="/matheusblog/assets/js/20.528ebeac.js"><link rel="prefetch" href="/matheusblog/assets/js/200.2b985a54.js"><link rel="prefetch" href="/matheusblog/assets/js/201.6bae60ce.js"><link rel="prefetch" href="/matheusblog/assets/js/202.533b05f0.js"><link rel="prefetch" href="/matheusblog/assets/js/203.f8160949.js"><link rel="prefetch" href="/matheusblog/assets/js/204.e3c321b2.js"><link rel="prefetch" href="/matheusblog/assets/js/205.04d870c4.js"><link rel="prefetch" href="/matheusblog/assets/js/206.4a77df8a.js"><link rel="prefetch" href="/matheusblog/assets/js/207.6f1d5049.js"><link rel="prefetch" href="/matheusblog/assets/js/208.bf3df0d4.js"><link rel="prefetch" href="/matheusblog/assets/js/209.9012cd83.js"><link rel="prefetch" href="/matheusblog/assets/js/21.f6754f6b.js"><link rel="prefetch" href="/matheusblog/assets/js/210.550f1a82.js"><link rel="prefetch" href="/matheusblog/assets/js/211.2bbfede1.js"><link rel="prefetch" href="/matheusblog/assets/js/212.02285a98.js"><link rel="prefetch" href="/matheusblog/assets/js/213.45f83b3f.js"><link rel="prefetch" href="/matheusblog/assets/js/214.78e8ec5e.js"><link rel="prefetch" href="/matheusblog/assets/js/215.e53f58e2.js"><link rel="prefetch" href="/matheusblog/assets/js/216.39c7871d.js"><link rel="prefetch" href="/matheusblog/assets/js/217.87d0a1c8.js"><link rel="prefetch" href="/matheusblog/assets/js/218.bd9b724c.js"><link rel="prefetch" href="/matheusblog/assets/js/219.e23e612d.js"><link rel="prefetch" href="/matheusblog/assets/js/22.3989ceee.js"><link rel="prefetch" href="/matheusblog/assets/js/220.2e76c963.js"><link rel="prefetch" href="/matheusblog/assets/js/221.dfaedadd.js"><link rel="prefetch" href="/matheusblog/assets/js/222.691fb01c.js"><link rel="prefetch" href="/matheusblog/assets/js/223.29836c1e.js"><link rel="prefetch" href="/matheusblog/assets/js/224.d98e81c8.js"><link rel="prefetch" href="/matheusblog/assets/js/225.300b2722.js"><link rel="prefetch" href="/matheusblog/assets/js/226.f8d576b5.js"><link rel="prefetch" href="/matheusblog/assets/js/227.df6d567f.js"><link rel="prefetch" href="/matheusblog/assets/js/228.d1627cf6.js"><link rel="prefetch" href="/matheusblog/assets/js/229.01ac1d14.js"><link rel="prefetch" href="/matheusblog/assets/js/23.4154b5e8.js"><link rel="prefetch" href="/matheusblog/assets/js/230.a10626c4.js"><link rel="prefetch" href="/matheusblog/assets/js/231.acdd1dd0.js"><link rel="prefetch" href="/matheusblog/assets/js/232.dd9fa402.js"><link rel="prefetch" href="/matheusblog/assets/js/233.1c92b876.js"><link rel="prefetch" href="/matheusblog/assets/js/234.f12292dd.js"><link rel="prefetch" href="/matheusblog/assets/js/235.9b02e412.js"><link rel="prefetch" href="/matheusblog/assets/js/236.3057cda4.js"><link rel="prefetch" href="/matheusblog/assets/js/237.a8095c0d.js"><link rel="prefetch" href="/matheusblog/assets/js/238.538382f5.js"><link rel="prefetch" href="/matheusblog/assets/js/239.4dd7e91a.js"><link rel="prefetch" href="/matheusblog/assets/js/24.d3f69cac.js"><link rel="prefetch" href="/matheusblog/assets/js/240.488d4f34.js"><link rel="prefetch" href="/matheusblog/assets/js/241.5bc47771.js"><link rel="prefetch" href="/matheusblog/assets/js/242.73776bd8.js"><link rel="prefetch" href="/matheusblog/assets/js/243.ce12ab85.js"><link rel="prefetch" href="/matheusblog/assets/js/244.a4fab78f.js"><link rel="prefetch" href="/matheusblog/assets/js/245.b120d9ee.js"><link rel="prefetch" href="/matheusblog/assets/js/246.6a28a169.js"><link rel="prefetch" href="/matheusblog/assets/js/247.07254d79.js"><link rel="prefetch" href="/matheusblog/assets/js/248.518312ab.js"><link rel="prefetch" href="/matheusblog/assets/js/249.6446ff6d.js"><link rel="prefetch" href="/matheusblog/assets/js/25.103cd310.js"><link rel="prefetch" href="/matheusblog/assets/js/250.e4f90568.js"><link rel="prefetch" href="/matheusblog/assets/js/251.4cfe8d17.js"><link rel="prefetch" href="/matheusblog/assets/js/252.e7dea130.js"><link rel="prefetch" href="/matheusblog/assets/js/253.1bf9ece2.js"><link rel="prefetch" href="/matheusblog/assets/js/254.b2904314.js"><link rel="prefetch" href="/matheusblog/assets/js/255.c3b32fc7.js"><link rel="prefetch" href="/matheusblog/assets/js/256.ea6a4512.js"><link rel="prefetch" href="/matheusblog/assets/js/257.fb092ce9.js"><link rel="prefetch" href="/matheusblog/assets/js/258.a26aae59.js"><link rel="prefetch" href="/matheusblog/assets/js/259.8ce39797.js"><link rel="prefetch" href="/matheusblog/assets/js/26.18539084.js"><link rel="prefetch" href="/matheusblog/assets/js/260.26a1a0c2.js"><link rel="prefetch" href="/matheusblog/assets/js/261.f6fba816.js"><link rel="prefetch" href="/matheusblog/assets/js/262.485779cf.js"><link rel="prefetch" href="/matheusblog/assets/js/263.65d01e01.js"><link rel="prefetch" href="/matheusblog/assets/js/264.e8c445d9.js"><link rel="prefetch" href="/matheusblog/assets/js/265.ff67faea.js"><link rel="prefetch" href="/matheusblog/assets/js/266.716fddd0.js"><link rel="prefetch" href="/matheusblog/assets/js/267.83f77072.js"><link rel="prefetch" href="/matheusblog/assets/js/268.3879656a.js"><link rel="prefetch" href="/matheusblog/assets/js/269.6b105223.js"><link rel="prefetch" href="/matheusblog/assets/js/27.5655bd98.js"><link rel="prefetch" href="/matheusblog/assets/js/270.67ee6be6.js"><link rel="prefetch" href="/matheusblog/assets/js/271.304e5d85.js"><link rel="prefetch" href="/matheusblog/assets/js/272.852cf36b.js"><link rel="prefetch" href="/matheusblog/assets/js/273.7251c840.js"><link rel="prefetch" href="/matheusblog/assets/js/274.0ca259d9.js"><link rel="prefetch" href="/matheusblog/assets/js/275.ada6724b.js"><link rel="prefetch" href="/matheusblog/assets/js/276.a8e9b4ed.js"><link rel="prefetch" href="/matheusblog/assets/js/277.0d3c295d.js"><link rel="prefetch" href="/matheusblog/assets/js/278.fbc0dc95.js"><link rel="prefetch" href="/matheusblog/assets/js/279.2d57fb41.js"><link rel="prefetch" href="/matheusblog/assets/js/28.7566810f.js"><link rel="prefetch" href="/matheusblog/assets/js/280.21690c55.js"><link rel="prefetch" href="/matheusblog/assets/js/281.78b9cb32.js"><link rel="prefetch" href="/matheusblog/assets/js/282.4c719a9d.js"><link rel="prefetch" href="/matheusblog/assets/js/283.df5cfe30.js"><link rel="prefetch" href="/matheusblog/assets/js/284.1c7d8c52.js"><link rel="prefetch" href="/matheusblog/assets/js/285.a3df93ea.js"><link rel="prefetch" href="/matheusblog/assets/js/286.94d51fc2.js"><link rel="prefetch" href="/matheusblog/assets/js/287.893dec0a.js"><link rel="prefetch" href="/matheusblog/assets/js/288.8748cc05.js"><link rel="prefetch" href="/matheusblog/assets/js/289.d19cf7f5.js"><link rel="prefetch" href="/matheusblog/assets/js/29.48af8c64.js"><link rel="prefetch" href="/matheusblog/assets/js/290.4336edf2.js"><link rel="prefetch" href="/matheusblog/assets/js/291.42f3d2c1.js"><link rel="prefetch" href="/matheusblog/assets/js/30.d0cbabcd.js"><link rel="prefetch" href="/matheusblog/assets/js/31.98361179.js"><link rel="prefetch" href="/matheusblog/assets/js/32.85b4e811.js"><link rel="prefetch" href="/matheusblog/assets/js/33.13a7edb7.js"><link rel="prefetch" href="/matheusblog/assets/js/34.3be81116.js"><link rel="prefetch" href="/matheusblog/assets/js/35.03300e00.js"><link rel="prefetch" href="/matheusblog/assets/js/36.6c8afecb.js"><link rel="prefetch" href="/matheusblog/assets/js/37.be42f6e2.js"><link rel="prefetch" href="/matheusblog/assets/js/38.476cf59a.js"><link rel="prefetch" href="/matheusblog/assets/js/39.35893d26.js"><link rel="prefetch" href="/matheusblog/assets/js/4.66af9795.js"><link rel="prefetch" href="/matheusblog/assets/js/40.fd8b5867.js"><link rel="prefetch" href="/matheusblog/assets/js/41.e5e2d1bb.js"><link rel="prefetch" href="/matheusblog/assets/js/42.2e61337e.js"><link rel="prefetch" href="/matheusblog/assets/js/43.ee3eb54f.js"><link rel="prefetch" href="/matheusblog/assets/js/44.dfa0da2e.js"><link rel="prefetch" href="/matheusblog/assets/js/45.143c1996.js"><link rel="prefetch" href="/matheusblog/assets/js/46.27c2b8fa.js"><link rel="prefetch" href="/matheusblog/assets/js/47.7338a5c4.js"><link rel="prefetch" href="/matheusblog/assets/js/48.620ee8a6.js"><link rel="prefetch" href="/matheusblog/assets/js/49.a01ff564.js"><link rel="prefetch" href="/matheusblog/assets/js/5.9f775e24.js"><link rel="prefetch" href="/matheusblog/assets/js/50.20ebe515.js"><link rel="prefetch" href="/matheusblog/assets/js/51.a30e6394.js"><link rel="prefetch" href="/matheusblog/assets/js/52.e6e592c7.js"><link rel="prefetch" href="/matheusblog/assets/js/53.f37b74f7.js"><link rel="prefetch" href="/matheusblog/assets/js/54.29299eb4.js"><link rel="prefetch" href="/matheusblog/assets/js/55.d2a1f235.js"><link rel="prefetch" href="/matheusblog/assets/js/56.4d804f62.js"><link rel="prefetch" href="/matheusblog/assets/js/57.d003c170.js"><link rel="prefetch" href="/matheusblog/assets/js/58.b10ce343.js"><link rel="prefetch" href="/matheusblog/assets/js/59.f09aa1bd.js"><link rel="prefetch" href="/matheusblog/assets/js/6.56debd2b.js"><link rel="prefetch" href="/matheusblog/assets/js/60.00414118.js"><link rel="prefetch" href="/matheusblog/assets/js/61.7eb333ee.js"><link rel="prefetch" href="/matheusblog/assets/js/62.95b27d73.js"><link rel="prefetch" href="/matheusblog/assets/js/63.2bf69393.js"><link rel="prefetch" href="/matheusblog/assets/js/64.6bf8260e.js"><link rel="prefetch" href="/matheusblog/assets/js/65.4e9099ae.js"><link rel="prefetch" href="/matheusblog/assets/js/66.c7a1c53e.js"><link rel="prefetch" href="/matheusblog/assets/js/67.ef4a2f26.js"><link rel="prefetch" href="/matheusblog/assets/js/68.b665e8b9.js"><link rel="prefetch" href="/matheusblog/assets/js/69.5392df55.js"><link rel="prefetch" href="/matheusblog/assets/js/7.eaf0ed17.js"><link rel="prefetch" href="/matheusblog/assets/js/70.27280771.js"><link rel="prefetch" href="/matheusblog/assets/js/71.3ab0e61c.js"><link rel="prefetch" href="/matheusblog/assets/js/72.7236852c.js"><link rel="prefetch" href="/matheusblog/assets/js/73.6e5710c6.js"><link rel="prefetch" href="/matheusblog/assets/js/74.3c83a761.js"><link rel="prefetch" href="/matheusblog/assets/js/75.2046b87d.js"><link rel="prefetch" href="/matheusblog/assets/js/76.c043e787.js"><link rel="prefetch" href="/matheusblog/assets/js/77.9a8c8165.js"><link rel="prefetch" href="/matheusblog/assets/js/78.f6bc0452.js"><link rel="prefetch" href="/matheusblog/assets/js/79.a256be52.js"><link rel="prefetch" href="/matheusblog/assets/js/8.1e05dc3f.js"><link rel="prefetch" href="/matheusblog/assets/js/80.fda12bb0.js"><link rel="prefetch" href="/matheusblog/assets/js/81.d845c813.js"><link rel="prefetch" href="/matheusblog/assets/js/82.4dcd3270.js"><link rel="prefetch" href="/matheusblog/assets/js/83.2891b14d.js"><link rel="prefetch" href="/matheusblog/assets/js/84.39a71340.js"><link rel="prefetch" href="/matheusblog/assets/js/85.05af1ffe.js"><link rel="prefetch" href="/matheusblog/assets/js/86.6a90563e.js"><link rel="prefetch" href="/matheusblog/assets/js/87.7644d504.js"><link rel="prefetch" href="/matheusblog/assets/js/88.2409506a.js"><link rel="prefetch" href="/matheusblog/assets/js/89.595587c1.js"><link rel="prefetch" href="/matheusblog/assets/js/9.93429f29.js"><link rel="prefetch" href="/matheusblog/assets/js/90.4ffbc90d.js"><link rel="prefetch" href="/matheusblog/assets/js/91.e1aa18fb.js"><link rel="prefetch" href="/matheusblog/assets/js/92.a162a855.js"><link rel="prefetch" href="/matheusblog/assets/js/93.4f479528.js"><link rel="prefetch" href="/matheusblog/assets/js/94.334d31c1.js"><link rel="prefetch" href="/matheusblog/assets/js/95.ead146a3.js"><link rel="prefetch" href="/matheusblog/assets/js/96.b5093d51.js"><link rel="prefetch" href="/matheusblog/assets/js/97.544ccdfb.js"><link rel="prefetch" href="/matheusblog/assets/js/99.d3c62835.js">
    <link rel="stylesheet" href="/matheusblog/assets/css/0.styles.980a01be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/matheusblog/" class="home-link router-link-active"><!----> <span class="site-name">MyBlog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Menu" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java Menu" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/basic/helloworld.html" class="nav-link">
  认识编程
</a></li></ul></li><li class="dropdown-item"><h4>
          集合
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/collection/泛型和集合.html" class="nav-link">
  泛型和集合
</a></li></ul></li><li class="dropdown-item"><h4>
          IO
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/io/IO.html" class="nav-link">
  IO
</a></li></ul></li><li class="dropdown-item"><h4>
          并发编程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/thread/多线程.html" class="nav-link">
  多线程
</a></li></ul></li><li class="dropdown-item"><h4>
          JVM
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/jvm/00虚拟机内存体系与垃圾回收.html" class="nav-link">
  JVM简介
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web Menu" class="dropdown-title"><span class="title">Web基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Web Menu" class="mobile-dropdown-title"><span class="title">Web基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/html5/01HTML概述.html" class="nav-link">
  HTML概述
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/css/01基础选择器+字体文本样式.html" class="nav-link">
  基础选择器+字体文本样式
</a></li></ul></li><li class="dropdown-item"><h4>
          JS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/js/01JavaScript基础.html" class="nav-link">
  JavaScript基础
</a></li></ul></li><li class="dropdown-item"><h4>
          VUE
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/vue/02模板语法.html" class="nav-link">
  Vue简介与安装使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="database Menu" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="database Menu" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          MySQL
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/db/mysql/02数据库和表的操作.html" class="nav-link">
  数据库和表的操作
</a></li></ul></li><li class="dropdown-item"><h4>
          MongoDB
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/db/mongodb/01数据库和集合基本操作.html" class="nav-link">
  数据库和集合基本操作
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringFramework Menu" class="dropdown-title"><span class="title">SpringFramework</span> <span class="arrow down"></span></button> <button type="button" aria-label="SpringFramework Menu" class="mobile-dropdown-title"><span class="title">SpringFramework</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Maven
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/maven/02Maven入门基础.html" class="nav-link">
  Maven入门基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Spring
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/spring/Spring概述.html" class="nav-link">
  Spring概述
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringMVC
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/springmvc/springMVC框架.html" class="nav-link">
  SpringMVC框架
</a></li></ul></li><li class="dropdown-item"><h4>
          MyBatis-plus
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/mybatis/01MyBatis简介.html" class="nav-link">
  MyBatis简介
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringBoot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/springboot/SpringBoot简介.html" class="nav-link">
  SpringBoot简介
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Devops Menu" class="dropdown-title"><span class="title">DevOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="Devops Menu" class="mobile-dropdown-title"><span class="title">DevOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          linux
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/devops/linux/00 Centos.html" class="nav-link">
  CentOS
</a></li></ul></li><li class="dropdown-item"><h4>
          tools
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/devops/tools/VS Code使用.html" class="nav-link">
  VS Code使用
</a></li></ul></li><li class="dropdown-item"><h4>
          k8s
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/devops/k8s/01Kubernetes介绍及使用.html" class="nav-link">
  K8s介绍与使用
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/matheusblog/md/springcloud/note.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  SpringCloud
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="develop Menu" class="dropdown-title"><span class="title">开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="develop Menu" class="mobile-dropdown-title"><span class="title">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          代码质量
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/develop/code-style/effective-java/目录.html" class="nav-link">
  Effective-Java
</a></li><li class="dropdown-subitem"><a href="/matheusblog/md/develop/JUnit/01什么是单元测试.html" class="nav-link">
  单元测试
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/matheusblog/md/arch/计算机软件架构发展历史.html" class="nav-link">
  架构
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="other-languages Menu" class="dropdown-title"><span class="title">其他语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="other-languages Menu" class="mobile-dropdown-title"><span class="title">其他语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/other-languages/go/01Go语言介绍.html" class="nav-link">
  Go语言介绍
</a></li></ul></li><li class="dropdown-item"><h4>
          Scala
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/other-languages/scala/Scala学习宝典.html" class="nav-link">
  Scala学习宝典
</a></li></ul></li><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/other-languages/python/Python基础学习.html" class="nav-link">
  Python基础学习
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Menu" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java Menu" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/basic/helloworld.html" class="nav-link">
  认识编程
</a></li></ul></li><li class="dropdown-item"><h4>
          集合
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/collection/泛型和集合.html" class="nav-link">
  泛型和集合
</a></li></ul></li><li class="dropdown-item"><h4>
          IO
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/io/IO.html" class="nav-link">
  IO
</a></li></ul></li><li class="dropdown-item"><h4>
          并发编程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/thread/多线程.html" class="nav-link">
  多线程
</a></li></ul></li><li class="dropdown-item"><h4>
          JVM
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/java/jvm/00虚拟机内存体系与垃圾回收.html" class="nav-link">
  JVM简介
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web Menu" class="dropdown-title"><span class="title">Web基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Web Menu" class="mobile-dropdown-title"><span class="title">Web基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/html5/01HTML概述.html" class="nav-link">
  HTML概述
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/css/01基础选择器+字体文本样式.html" class="nav-link">
  基础选择器+字体文本样式
</a></li></ul></li><li class="dropdown-item"><h4>
          JS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/js/01JavaScript基础.html" class="nav-link">
  JavaScript基础
</a></li></ul></li><li class="dropdown-item"><h4>
          VUE
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/web/vue/02模板语法.html" class="nav-link">
  Vue简介与安装使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="database Menu" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="database Menu" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          MySQL
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/db/mysql/02数据库和表的操作.html" class="nav-link">
  数据库和表的操作
</a></li></ul></li><li class="dropdown-item"><h4>
          MongoDB
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/db/mongodb/01数据库和集合基本操作.html" class="nav-link">
  数据库和集合基本操作
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringFramework Menu" class="dropdown-title"><span class="title">SpringFramework</span> <span class="arrow down"></span></button> <button type="button" aria-label="SpringFramework Menu" class="mobile-dropdown-title"><span class="title">SpringFramework</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Maven
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/maven/02Maven入门基础.html" class="nav-link">
  Maven入门基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Spring
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/spring/Spring概述.html" class="nav-link">
  Spring概述
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringMVC
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/springmvc/springMVC框架.html" class="nav-link">
  SpringMVC框架
</a></li></ul></li><li class="dropdown-item"><h4>
          MyBatis-plus
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/mybatis/01MyBatis简介.html" class="nav-link">
  MyBatis简介
</a></li></ul></li><li class="dropdown-item"><h4>
          SpringBoot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/spring/springboot/SpringBoot简介.html" class="nav-link">
  SpringBoot简介
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Devops Menu" class="dropdown-title"><span class="title">DevOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="Devops Menu" class="mobile-dropdown-title"><span class="title">DevOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          linux
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/devops/linux/00 Centos.html" class="nav-link">
  CentOS
</a></li></ul></li><li class="dropdown-item"><h4>
          tools
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/devops/tools/VS Code使用.html" class="nav-link">
  VS Code使用
</a></li></ul></li><li class="dropdown-item"><h4>
          k8s
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/devops/k8s/01Kubernetes介绍及使用.html" class="nav-link">
  K8s介绍与使用
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/matheusblog/md/springcloud/note.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  SpringCloud
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="develop Menu" class="dropdown-title"><span class="title">开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="develop Menu" class="mobile-dropdown-title"><span class="title">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          代码质量
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/develop/code-style/effective-java/目录.html" class="nav-link">
  Effective-Java
</a></li><li class="dropdown-subitem"><a href="/matheusblog/md/develop/JUnit/01什么是单元测试.html" class="nav-link">
  单元测试
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/matheusblog/md/arch/计算机软件架构发展历史.html" class="nav-link">
  架构
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="other-languages Menu" class="dropdown-title"><span class="title">其他语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="other-languages Menu" class="mobile-dropdown-title"><span class="title">其他语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/other-languages/go/01Go语言介绍.html" class="nav-link">
  Go语言介绍
</a></li></ul></li><li class="dropdown-item"><h4>
          Scala
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/other-languages/scala/Scala学习宝典.html" class="nav-link">
  Scala学习宝典
</a></li></ul></li><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/matheusblog/md/other-languages/python/Python基础学习.html" class="nav-link">
  Python基础学习
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matheusblog/md/springcloud/note.html" aria-current="page" class="active sidebar-link">微服务部署</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matheusblog/md/springcloud/mq/01RabbitMQ.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/matheusblog/md/springcloud/mq/02SpringBoot整合.html" class="sidebar-link">SpringBoot整合</a></li><li><a href="/matheusblog/md/springcloud/mq/03消息队列对比.html" class="sidebar-link">消息队列对比</a></li><li><a href="/matheusblog/md/springcloud/mq/04RocketMQ.html" class="sidebar-link">RocketMQ</a></li><li><a href="/matheusblog/md/springcloud/mq/05使用RocketMQ原生API收发消息代码样例.html" class="sidebar-link">使用RocketMQ原生API收发消息代码样例</a></li><li><a href="/matheusblog/md/springcloud/mq/06Springboot整合RocetMQ收发消息样例.html" class="sidebar-link">Springboot整合RocetMQ收发消息样例</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微服务部署"><a href="#微服务部署" class="header-anchor">#</a> 微服务部署</h1> <p></p><div class="table-of-contents"><ul><li><a href="#开发环境">开发环境</a></li><li><a href="#spring-cloud-netflix">Spring cloud Netflix</a></li><li><a href="#eureka">eureka</a></li><li><a href="#高可用">高可用</a></li><li><a href="#feign-远程调用、ribbin-负载均衡和重试">Feign 远程调用、Ribbin 负载均衡和重试</a></li><li><a href="#zuul-api-网关">Zuul API 网关</a></li><li><a href="#hystrix-容错和限流">Hystrix 容错和限流</a></li><li><a href="#turbine">Turbine</a></li><li><a href="#spring-cloud-config-配置中心">Spring cloud config 配置中心</a></li><li><a href="#vmware">VMware</a></li><li><a href="#rabbitmq">Rabbitmq</a></li><li><a href="#消息服务使用案例">消息服务使用案例</a></li><li><a href="#spring-cloud-config-bus-配置刷新">Spring cloud config + BUS 配置刷新</a></li><li><a href="#sleuth-zipkin-链路跟踪">Sleuth + Zipkin 链路跟踪</a></li><li><a href="#eureka注册-选择正确网卡、注册ip而不是主机名">eureka注册，选择正确网卡、注册ip而不是主机名</a></li><li><a href="#订单流量削峰">订单流量削峰</a></li><li><a href="#分布式事务">分布式事务</a><ul><li><a href="#业务案例">业务案例</a></li><li><a href="#全局唯一id发号器">全局唯一id发号器</a></li><li><a href="#订单调用发号器、库存、账户">订单调用发号器、库存、账户</a></li></ul></li><li><a href="#分布式事务">分布式事务</a><ul><li><a href="#seata">seata</a></li><li><a href="#seata-at-事务">seata at 事务</a></li><li><a href="#tcc-事务方案">TCC 事务方案</a></li></ul></li><li><a href="#rocketmq">Rocketmq</a><ul><li><a href="#搭建服务器">搭建服务器</a></li><li><a href="#rocketmq启动命令">Rocketmq启动命令</a></li><li><a href="#rocketmq-收发消息api">Rocketmq  收发消息api</a></li><li><a href="#可靠消息最终一致性事务">可靠消息最终一致性事务</a></li></ul></li><li><a href="#devops-开发运维一体化">DevOps 开发运维一体化</a><ul><li><a href="#docker">Docker</a></li></ul></li><li><a href="#elasticsearch">Elasticsearch</a><ul><li><a href="#搭建-es-服务器">搭建 ES 服务器</a></li><li><a href="#拼多商城搜索条">拼多商城搜索条</a></li><li><a href="#kubernetes">Kubernetes</a></li><li><a href="#安装搭建-k8s-集群">安装搭建 K8s 集群</a></li><li><a href="#k8s三个核心概念">K8s三个核心概念</a></li></ul></li><li><a href="#小结">小结</a><ul><li><a href="#spring-cloud-netflix">Spring cloud Netflix</a></li><li><a href="#消息服务">消息服务</a></li><li><a href="#分布式事务">分布式事务</a></li><li><a href="#devops">DevOps</a></li><li><a href="#elasticsearch">Elasticsearch</a></li></ul></li></ul></div><p></p> <h2 id="开发环境"><a href="#开发环境" class="header-anchor">#</a> 开发环境</h2> <ul><li><p>IDEA</p></li> <li><p>Lombok</p></li> <li><p>EditStarters</p></li> <li><p>Free MyBatis Plugin / MybatisX</p></li> <li><p>Maven Helper</p></li> <li><p>Maven</p> <ul><li>使用阿里仓库和中央仓库，来回切换更新
<ul><li>settings.xml 不配置任何镜像仓库，默认使用中央仓库</li></ul></li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/SETTINGS/1.0.0<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/SETTINGS/1.0.0
                          https://maven.apache.org/xsd/settings-1.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">&gt;</span></span>D:\home\java\maven_repository<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localRepository</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">&gt;</span></span>

		<span class="token comment">&lt;!--&lt;mirror&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;id&gt;alimaven&lt;/id&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;name&gt;aliyun maven&lt;/name&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;mirrorOf&gt;central&lt;/mirrorOf&gt;--&gt;</span>
		<span class="token comment">&lt;!--&lt;/mirror&gt;--&gt;</span>

		<span class="token comment">&lt;!--&lt;mirror&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;id&gt;huaweicloud&lt;/id&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;--&gt;</span>
		<span class="token comment">&lt;!--	&lt;url&gt;https://mirrors.huaweicloud.com/repository/maven/&lt;/url&gt;--&gt;</span>
		<span class="token comment">&lt;!--&lt;/mirror&gt;--&gt;</span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li><p>在本地仓库目录中搜索“lastupdate”，删除所有lastupdate文件后再重新更新</p></li> <li><p>找到本地仓库的依赖包，删除后重新更新</p></li> <li><p>复制同学的本地仓库中的依赖包</p></li></ul></li> <li><p>新工程的  Maven 默认配置：</p> <ul><li>File - New Projects Settings - Settings for new projects</li></ul></li> <li><p>springboot版本：  2.3.2.RELEASE</p></li> <li><p>springcloud版本： Hoxton.SR12</p></li></ul> <h2 id="spring-cloud-netflix"><a href="#spring-cloud-netflix" class="header-anchor">#</a> Spring cloud Netflix</h2> <ul><li>注册中心
<ul><li>Eureka</li></ul></li> <li>配置中心
<ul><li>Spring cloud config</li></ul></li> <li>远程调用/负载均衡
<ul><li>Feign</li> <li>Ribbon</li></ul></li> <li>系统容错、限流
<ul><li>Hystrix</li> <li>容错：
<ul><li>容错的手段：降级</li></ul></li> <li>限流：
<ul><li>限流的手段：熔断</li></ul></li></ul></li> <li>数据监控
<ul><li>Hystrix dashboard / Turbine</li> <li>链路跟踪 Sleuth / Zipkin</li></ul></li></ul> <h2 id="eureka"><a href="#eureka" class="header-anchor">#</a> eureka</h2> <p><strong>搭建eureka服务器：</strong></p> <ol><li><p>新建 spring 模块：sp05-eureka</p></li> <li><p>添加依赖： eureka server</p></li> <li><p>yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>关闭自我保护模式
主机名：eureka1
针对单台服务器：
	不向自己注册
	不从自己拉取
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>启动类添加注解：<code>@EnableEurekaServer</code>
用来触发 eureka server 的自动配置</p></li></ol> <p><strong>eureka运行机制：</strong></p> <ol><li><strong>注册</strong>
客户端应用会一次一次地反复注册，直到注册成功为止</li> <li><strong>拉取</strong>
客户端应用每隔30秒，拉取一次注册表，来刷新本地缓存的注册表</li> <li><strong>心跳</strong>
客户端应用每隔30秒发送一次心跳
服务器连续3次收不到一个模块的心跳，会删除它的注册信息</li> <li><strong>自我保护模式</strong>
由于网络故障，15分钟内，85%服务器出现心跳异常，会自动进入保护模式。
所有注册信息都不删除
等待网络恢复后，会自动退出保护模式，恢复到正常模式
开发调试期间，应该禁用保护模式，避免影响测试</li></ol> <p><strong>eureka客户端：</strong></p> <p>修改 2,3,4 模块</p> <ol><li><p>依赖： eureka client</p></li> <li><p>yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>服务器注册地址： http<span class="token punctuation">:</span>//eureka1<span class="token punctuation">:</span>2001/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p>http://eureka1:2001/eureka eureka子路径，是客户端调用的 api 路径</p> <h2 id="高可用"><a href="#高可用" class="header-anchor">#</a> 高可用</h2> <p><strong>商品高可用：</strong></p> <p>在 8001 和 8002 端口，重复启动两个商品服务</p> <p>命令行参数来设置端口：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 命令行参数，可以覆盖 yml 配置的端口</span>
java -jar item.jar --server.port<span class="token operator">=</span><span class="token number">8001</span>

java -jar item.jar --server.port<span class="token operator">=</span><span class="token number">8002</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>idea启动配置中，配置命令参数：</p> <ul><li>运行配置的下拉菜单 -- Edit Configuration</li> <li>修改 program arguments，添加参数： <code>--server.port=8001</code></li> <li>左边的商品启动配置，复制一份，改成 <code>--server.port=8002</code></li></ul> <p><strong>eureka高可用：</strong></p> <ol><li>新建两个profile配置文件：</li></ol> <ul><li>application-eureka1.yml</li> <li>application-eureka2.yml</li></ul> <ol start="2"><li>设置两个 eureka 的启动配置参数：
<ul><li>--spring.progiles.active=eureka1</li> <li>--spring.progiles.active=eureka2</li></ul></li> <li>客户端应用连接两个eureka服务：
<ul><li>defaultZone: http://eureka1:2001/eureka,http://eureka2:2002/eureka</li></ul></li></ol> <h2 id="feign-远程调用、ribbin-负载均衡和重试"><a href="#feign-远程调用、ribbin-负载均衡和重试" class="header-anchor">#</a> Feign 远程调用、Ribbin 负载均衡和重试</h2> <p>修改 04 项目，完成远程调用</p> <ol><li>添加 feign 依赖</li> <li>启动类注解： <code>@EnableFeignClients</code>
触发 Feign 自动配置，扫描远程调用接口，创建动态代理对象</li> <li>定义远程调用接口
<ul><li>ItemClient</li> <li>UserClient</li></ul></li> <li>OrderServiceImpl ，完成远程调用</li></ol> <p><strong>Feign 集成 Ribbon</strong>：</p> <ul><li>默认启用了负载均衡和重试</li></ul> <p><strong>Ribbon重试：</strong></p> <p>调用后台服务失败，可以自动进行重试调用</p> <p>重试参数：</p> <ul><li>MaxAutoRetries - 单台服务器的重试次数，默认 0</li> <li>MaxAutoRetriesNextServer - 更换服务器的次数，默认 1</li> <li>ReadTimeout - 等待响应的超时时间，默认 1000</li></ul> <p><strong>测试Ribbon重试:</strong></p> <ul><li>02商品，添加随机延迟代码</li> <li>04调用02，超时失败，会进行重试</li></ul> <h2 id="zuul-api-网关"><a href="#zuul-api-网关" class="header-anchor">#</a> Zuul API 网关</h2> <p>系统的调用入口</p> <ul><li>统一的调用入口</li> <li>统一的权限校验</li> <li>集成 Ribbon</li> <li>集成 Hystrix</li></ul> <p><strong>统一的调用入口：</strong></p> <ol><li><p>新建 spring 模块： sp06-zuul</p></li> <li><p>添加依赖：</p> <ul><li>zuul</li> <li>eureka client</li> <li>sp01</li></ul></li> <li><p>yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># ** 包含深层子路径</span>
<span class="token comment"># *  只包含一层路径</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token key atrule">item-service</span><span class="token punctuation">:</span> /item<span class="token punctuation">-</span>service/<span class="token important">**</span>
    <span class="token key atrule">user-service</span><span class="token punctuation">:</span> /user<span class="token punctuation">-</span>service/<span class="token important">**</span>
    <span class="token key atrule">order-service</span><span class="token punctuation">:</span> /order<span class="token punctuation">-</span>service/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>启动类注解： <code>@EnableZuulProxy</code></p></li></ol> <p><strong>统一权限校验：</strong></p> <p>模拟登陆：</p> <p>http://localhost:3001/item-service/i6juh65g4f3  没有登录，阻止访问</p> <p>http://localhost:3001/item-service/i6juh65g4f3?jwt=iu5hyg45f34t43y  已经登录，可以访问</p> <ol><li>新建过滤器类 AccessFilter，继承 ZuulFilter</li> <li>按规则实现抽象方法</li> <li>添加 <code>@Component</code> 注解</li></ol> <ul><li>Zuul 自动配置，会在spring容器中发现过滤器实例，完成自动配置</li></ul> <p><strong>Zuul集成Ribbon：</strong></p> <ul><li>默认启动 ribbon 的负载均衡</li> <li>默认不启动用重试
<ul><li>在最前面网关位置重试，会造成大量服务器压力翻倍</li></ul></li></ul> <p><strong>Zuul启用重试：</strong></p> <ul><li>添加 spring-retry 依赖</li> <li>yml配置： zuul.retryable=true</li></ul> <p><strong>Zuul 集成 Hysrix：</strong></p> <p>默认已经启用了 Hystrix</p> <h2 id="hystrix-容错和限流"><a href="#hystrix-容错和限流" class="header-anchor">#</a> Hystrix 容错和限流</h2> <ul><li>容错 - 处理远程调用的错误
<ul><li>容错的手段： 降级</li></ul></li> <li>限流 - 由于流量过大造成故障，要限制后台模块的访问流量，减轻压力
<ul><li>限流的手段： 熔断</li></ul></li></ul> <p><strong>容错、降级：</strong></p> <ul><li>实现 zuul 的接口： FallbackProvider</li> <li>按规则实现抽象方法</li> <li>添加 <code>@component</code> 注解</li> <li>zuul 会自动配置降级类</li></ul> <p><strong>限流、熔断：</strong></p> <p>Hystrix熔断条件，断路器打开条件：</p> <ul><li>10秒20次请求（必须首先满足）</li> <li>50%请求出错，执行了降级</li></ul> <p><strong>断路器打开后，会进入“半开状态”：</strong></p> <ul><li>尝试向后台模块发送一次客户端调用</li> <li>如果调用成功，会关闭断路器，恢复正常</li> <li>如果调用失败，继续保持打开状态</li></ul> <p><strong>Hystrix dashboard 仪表盘数据监控：</strong></p> <p>利用 Actuator 来暴露 Hystrix 的监控日志，Hystrix dashboard会抓取日志，对日志进行分析处理</p> <p><strong>Actuator</strong></p> <p>spring提供的一个项目指标工具</p> <ul><li>健康状态</li> <li>spring容器中所有的对象</li> <li>springmvc 所有的访问路径</li> <li>jvm堆内存镜像文件</li> <li>hystrix 监控日志</li></ul> <p>添加 actuator：</p> <ol><li><p>添加 actuator 依赖</p></li> <li><p>yml配置</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">m.e.w.e.i</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>      <span class="token comment"># 暴露所有的监控指标</span>

<span class="token key atrule">m.e.w.e.i</span><span class="token punctuation">:</span> health<span class="token punctuation">,</span>beans<span class="token punctuation">,</span>mappings      <span class="token comment"># 暴露感兴趣的指标</span>

<span class="token key atrule">m.e.w.e.i</span><span class="token punctuation">:</span> hystrix.stream			  <span class="token comment"># 暴露hystrix监控日志</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>访问查看所有监控指标的地址：
<code>http://localhost:3001/actuator</code></p></li></ol> <p><strong>搭建 Hyastrix dashboard：</strong></p> <ol><li><p>新建 spring 模块：sp07-hystrix-dashboard</p></li> <li><p>添加依赖： hystrix dashboard</p></li> <li><p>yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">允许抓取的服务器列表</span><span class="token punctuation">:</span> localhost
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动类注解： <code>@EnableHystrixDashboard</code></p></li></ol> <ul><li>浏览器访问： <code>http://localhost:4001/hystrix</code>
从 <code>http://localhost:3001/actuator/hystrix.stream</code> 抓取日志</li></ul> <h2 id="turbine"><a href="#turbine" class="header-anchor">#</a> Turbine</h2> <p>从多台服务器聚合监控数据，将聚合后的数据交给仪表盘进行处理</p> <ol><li><p>新建  spring 模块： sp08-turbine</p></li> <li><p>添加依赖</p> <ul><li>turbine</li> <li>eureka client</li></ul></li> <li><p>yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>抓取的模块：zuul
为聚合后的数据命名：new String(&quot;default&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>启动类注解： <code>@EnableTurbine</code></p></li></ol> <ul><li>聚合后的日志数据访问路径：
http://localhost:5001/turbine.stream</li></ul> <h2 id="spring-cloud-config-配置中心"><a href="#spring-cloud-config-配置中心" class="header-anchor">#</a> Spring cloud config 配置中心</h2> <p>集中地管理和维护配置文件</p> <p><strong>检查Git环境：</strong></p> <ol><li>访问 git 官网下载 git</li> <li>安装 git</li> <li>settings -- git -- 配置 git.exe 的路径</li></ol> <p><strong>准备本地Git仓库：</strong></p> <ol><li>在 springcloud1 工程目录下，新建 config 文件夹</li> <li>复制 2,3,4 的 application.yml 到 config 文件夹
<ul><li>item-service-dev.yml</li> <li>user-service-dev.yml</li> <li>order-service-dev.yml</li></ul></li> <li>double shift  --  action -- 搜索 create git repository</li> <li>选择 springcloud1 工程目录作为本地的仓库目录
<ul><li><strong>如果已经有仓库，不要重复创建，也不不要嵌套创建仓库</strong></li></ul></li> <li>double shift  --  action -- 搜索 commit</li> <li>全选文件，填写提交信息，完成提交</li></ol> <p><strong>本地仓库推送到远程仓库：</strong></p> <ol><li>double shift -- action -- 搜索 push</li> <li>点 define remote，粘贴远程仓库地址</li></ol> <p><strong>防止配置中心的的配置，覆盖本地配置和命令参数：</strong></p> <ul><li>override-none = true</li></ul> <p><strong>搭建配置中心：</strong></p> <ol><li><p>新建 spring 模块： sp09-config</p></li> <li><p>添加依赖：</p> <ul><li>config server</li> <li>eureka client</li></ul></li> <li><p>yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>git仓库的地址： https<span class="token punctuation">:</span>//gitee.com/账户/仓库
存放配置文件的文件夹： config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>启动类注解： <code>@EnableConfigServer</code></p></li></ol> <ul><li><p>api.http 调用测试</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">###</span>
GET http://locahost:6001/item-service/dev
<span class="token comment">###</span>
GET http://locahost:6001/user-service/dev
<span class="token comment">###</span>
GET http://locahost:6001/order-service/dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>检查注册表中的注册信息： <code>config-server</code></p></li></ul> <p><strong>配置中心的客户端应用：</strong></p> <ol><li>添加依赖： config client</li> <li>新建配置文件： <code>bootstrap.yml</code> <ul><li>引导配置，
<ul><li>项目启动时，先执行引导配置</li> <li>之后才执行 application.yml  的应用配置</li></ul></li></ul></li> <li>添加三条配置：
<ol><li>连接 eureka</li> <li>设置配置陪着中心的 service id</li> <li>下载配置文件</li></ol></li></ol> <ul><li>控制台前两行的日志：
<ul><li>连接 6001</li> <li>下载指定的配置文件</li></ul></li></ul> <p><strong>启动顺序：</strong></p> <ol><li>启动 05
等待05完全启动完成</li> <li>启动 09
等待09完全启动完成</li> <li>检查注册表，有没有 config-server</li> <li>启动 2,3</li> <li>启动 4</li> <li>查看 2,3,4 的控制台，连接6001的日志</li> <li>启动 6</li></ol> <h2 id="vmware"><a href="#vmware" class="header-anchor">#</a> VMware</h2> <p>16+</p> <p><strong>Nat网络网段设置成 <code>192.168.64.0</code>：</strong></p> <ul><li>编辑 -- 虚拟网络编辑器 -- 上面选择 VMnet8 -- 左下角修改网段
<ul><li>注意： <strong>第四个值是0</strong></li></ul></li></ul> <p><strong>虚拟机：</strong></p> <ul><li>课前资料/虚拟机/centos-8-2105.zip
解压缩</li> <li>双击 <code>centos-8-2105.vmx</code>  加载虚拟机镜像</li> <li>启动虚拟机
<ul><li>按提示选择 “已复制虚拟机”</li> <li>如果看到“硬件不兼容”
<ul><li>右键点虚拟机 -- 管理 -- 更改硬件兼容性 -- 选择自己的 vmware 版本</li></ul></li></ul></li> <li>登录的用户名和密码都是 <code>root</code></li></ul> <p><strong>虚拟机中的基础设置：</strong></p> <ul><li>设置了阿里的 yum 安装源
<ul><li>阿里yum安装源最近做了调整，需要重新设置 yum 安装源</li></ul></li> <li>安装了三个工具： python、pip、ansible</li> <li>两个脚本文件，用来设置 ip 地址
<ul><li>ip-dhcp： 自动获取ip</li> <li>ip-static： 设置固定ip</li></ul></li></ul> <p><strong>设置 ip 地址：</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ip-dhcp

<span class="token comment"># 如果设置ip失败，可以尝试执行下面两条命令，再重新设置ip：</span>
nmcli n on

systemctl restart NetworkManager

<span class="token comment"># 查看ens33网卡的ip</span>
<span class="token function">ifconfig</span>

<span class="token function">ifconfig</span> ens33
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>重新设置阿里 yum 安装源：</strong></p> <ul><li><p>moboxterm  连接服务器</p></li> <li><p>执行下面操作：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 备份yum源配置</span>
<span class="token function">mv</span> /etc/yum.repos.d/CentOS-Linux-BaseOS.repo /etc/yum.repos.d/CentOS-Linux-BaseOS.repo.backup

<span class="token comment"># 下载阿里 yum 源配置文件</span>
<span class="token function">curl</span> -o /etc/yum.repos.d/CentOS-Linux-BaseOS.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo

<span class="token comment"># mirrors.cloud.aliyuncs.com 服务器地址改成 mirrors.aliyuncs.com</span>
<span class="token function">sed</span> -i -e <span class="token string">'/mirrors.cloud.aliyuncs.com/d'</span> -e <span class="token string">'/mirrors.aliyuncs.com/d'</span> /etc/yum.repos.d/CentOS-Linux-BaseOS.repo


<span class="token function">vim</span> /etc/yum.repos.d/CentOS-Linux-AppStream.repo
<span class="token comment"># 注释掉 mirrorlist，</span>
<span class="token comment"># 添加下面一行</span>
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://mirrors.aliyun.com/centos-vault/8.5.2111/AppStream/<span class="token variable">$basearch</span>/os/

yum makecache
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul> <p><strong>准备 Docker 服务器：</strong></p> <ul><li><p>centos-8-2105 关机： <code>shutdown -h now</code></p></li> <li><p>克隆 centos-8-2105： docker-base</p></li> <li><p>查看ip</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ifconfig</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>用 moboxterm 连接服务器，上传离线安装文件</p> <ul><li>DevOps课前资料\docker\docker-install 文件夹
上传到  /root/ 目录</li></ul></li> <li><p>按照 csdn 笔记安装 docker：<a href="https://wanght.blog.csdn.net/article/details/117327543" target="_blank" rel="noopener noreferrer">Docker（一） - 离线安装<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
从<strong>第三步</strong>开始安装</p></li> <li><p>关闭防火墙</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl stop firewalld

systemctl disable firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>关机： <code>shutdown -h now</code></p></li></ul> <h2 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> Rabbitmq</h2> <p><strong>Docker运行Rabbitmq服务：</strong></p> <ol><li><p>克隆 docker base： rabbitmq</p></li> <li><p>设置固定ip：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ip-static
ip: <span class="token number">192.168</span>.64.140

<span class="token function">ifconfig</span>
<span class="token comment"># 如果设置ip出错，参考上面 ip 设置，执行两条命令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>上传文件到 /root/</p> <ul><li>DevOps课前资料\docker\rabbit-image.gz</li></ul></li> <li><p>导入镜像：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> load -i rabbit-image.gz
<span class="token function">docker</span> images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>参考 csdn 笔记启动 rabbitmq</p> <ul><li><a href="https://wanght.blog.csdn.net/article/details/102810522" target="_blank" rel="noopener noreferrer">RabbitMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Docker运行rabbitmq</li></ul></li></ol> <p><strong>工作模式合理分发消息：</strong></p> <ol><li>使用手动确认模式
消息分发不合理的原因，是服务器不知道消费者有没有处理完消息。
使用手动确认模式，不仅是保证消息被正确处理，也可以让服务器知道消费者有没有处理完消息。</li> <li>qos=1
每次只接收1条消息，处理完成之前不接收下一条。
只在手动确认模式才有效。</li></ol> <p><strong>防止服务器崩溃，消息丢失：</strong></p> <p>消息的持久化：</p> <ol><li>队列设置成持久队列</li> <li>发送的消息设置成持久消息</li></ol> <p><strong>常见的面试题：rabbitmq防止消息丢失：</strong></p> <ol><li>手动确认模式
保证消息被正确处理，不丢失消息</li> <li>消息的持久化
防止服务器崩溃丢失消息</li></ol> <h2 id="消息服务使用案例"><a href="#消息服务使用案例" class="header-anchor">#</a> 消息服务使用案例</h2> <ol><li>BUS 配置刷新
通过Rabbitmq发送刷新指令到各个模块，各个模块接收到指令后执行刷新操作
使用Rabbitmq的主题模式</li> <li>Sleuth+Zipkin链路跟踪
Sleuth产生的链路跟踪日志，发送到Rabbitmq，
Zipkin从Rabbitmq接收日志
简单模式</li> <li>商城系统，订单流量削峰
商城系统中产生的订单，发送到消息队列，
后台的消费者模块接收并存储订单
简单模式、工作模式</li> <li></li></ol> <h2 id="spring-cloud-config-bus-配置刷新"><a href="#spring-cloud-config-bus-配置刷新" class="header-anchor">#</a> Spring cloud config + BUS 配置刷新</h2> <p>修改 2,3,4,9</p> <ol><li><p>添加依赖：</p> <ul><li>bus</li> <li>rabbitmq</li> <li>binder-rabbit</li></ul></li> <li><p>在 09 中添加 actuator 依赖</p></li> <li><p>yml 配置添加 rabbitmq 连接配置</p> <ul><li>修改 09 的 application.yml</li> <li>修改 config 目录的三个配置文件，提交推送到远程仓库</li></ul></li> <li><p>修改 09 的 yml 配置，暴露 bus-refresh 刷新路径</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>m.e.w.e.i=bus-refresh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p>测试：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>GET http://localhost:6001/actuator
查看确认，是否已经暴露 bus-refresh 刷新路径

POST http://localhost:6001/actuator/bus-refresh
观察 2,3,4 的控制台，有没有执行刷新操作
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="sleuth-zipkin-链路跟踪"><a href="#sleuth-zipkin-链路跟踪" class="header-anchor">#</a> Sleuth + Zipkin 链路跟踪</h2> <p><strong>Sleuth</strong></p> <p>产生链路跟踪日志的工具</p> <p>添加 Sleuth 只需要添加它的依赖，0配置</p> <p>A --&gt; B --&gt; C --&gt; D</p> <p>日志数据：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>A, 87J6H5GF34F, 87J6H5GF34F, <span class="token boolean">true</span>
B, 87J6H5GF34F, OI67U545Y43, <span class="token boolean">true</span>
C, 87J6H5GF34F, U45Y46U56Y3, <span class="token boolean">true</span>
D, 87J6H5GF34F, U545T234264, <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>修改 2,3,4,6，添加 sleuth 依赖</p> <p><strong>链路跟踪日志发送到 rabbitmq：</strong></p> <ol><li>修改2,3,4,6添加依赖： zipkin client</li> <li>单独修改 6，添加 rabbitmq
<ul><li>rabbitmq依赖</li> <li>rabbitmq连接配置</li></ul></li> <li>yml配置发送方式： <code>zipkin.sender.type=rabbit</code> <ul><li>06修改  application.yml</li> <li>2,3,4修改 config  目录的三个文件，再提交推送</li></ul></li></ol> <p><strong>启动 zipkin 服务：</strong></p> <p>在磁盘找到 zipkin 的 jar 文件，地址栏输入 cmd 启动命令行，执行启动命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 旧版本</span>
java -jar zipkin-server-2.12.9-exec.jar --zipkin.collector.rabbitmq.uri<span class="token operator">=</span>amqp://admin:admin@192.168.64.140:5672


<span class="token comment"># 新版本</span>
java -jar zipkin-server-2.23.4-exec.jar --zipkin.collector.rabbitmq.uri<span class="token operator">=</span>amqp://admin:admin@192.168.64.140:5672
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="eureka注册-选择正确网卡、注册ip而不是主机名"><a href="#eureka注册-选择正确网卡、注册ip而不是主机名" class="header-anchor">#</a> eureka注册，选择正确网卡、注册ip而不是主机名</h2> <p><strong>选择正确网卡：</strong></p> <p>使用 <strong>bootstrap.yml</strong> 在引导阶段来选择网卡</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">inetutils</span><span class="token punctuation">:</span>
      <span class="token key atrule">ignored-interfaces</span><span class="token punctuation">:</span> <span class="token comment"># 忽略的网卡</span>
        <span class="token punctuation">-</span> VM.*
      <span class="token key atrule">preferred-networks</span><span class="token punctuation">:</span> <span class="token comment"># 要是用的网卡的网段</span>
        <span class="token punctuation">-</span> 192\.168\.0\..+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>注册ip而不是主机名：</strong></p> <p>使用 <strong>application.yml</strong> 配置</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 使用ip进行注册</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="订单流量削峰"><a href="#订单流量削峰" class="header-anchor">#</a> 订单流量削峰</h2> <p><strong>导入项目到 rabbitmq 工程：</strong></p> <ol><li>课前资料/elasticsearch/pd-商城项目案例.zip
把 pd\pd-web 文件夹，解压缩到 rabbitmq 工程目录</li> <li>pd-web\pom.xml 拖拽到 idea</li> <li>修改 springboot 版本： <code>2.3.2.RELEASE</code></li> <li>导入项目： 在编辑器中右键 -- add as maven project</li> <li>application.yml  数据库连接密码</li></ol> <p><strong>导入数据库：</strong></p> <ol><li><p>sqlyog，右键点数据库的连接 -- 从sql转储文件导入 -- 选择 pd-web 文件夹的  pd.sql</p></li> <li><p>如果导入失败，执行四条sql，增大mysql的缓存区，再重新导入</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> max_allowed_packet<span class="token operator">=</span><span class="token number">100000000</span><span class="token punctuation">;</span>

<span class="token keyword">set</span> <span class="token keyword">global</span> net_buffer_length<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span>  interactive_timeout<span class="token operator">=</span><span class="token number">28800000</span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span>  wait_timeout<span class="token operator">=</span><span class="token number">28800000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>清除数据：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> pd_user<span class="token punctuation">;</span>

<span class="token keyword">delete</span> <span class="token keyword">from</span> pd_order<span class="token punctuation">;</span>

<span class="token keyword">delete</span> <span class="token keyword">from</span> pd_order_item<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <p><strong>启动 pd-web：</strong></p> <ol><li>右键执行 RunPdAPP</li> <li>启动配置中，设置 working directory
设置成 pd-web  模块文件夹路径</li> <li>重启 RunPdAPP</li> <li>访问 <code>http://localhost</code></li> <li>如果浏览器在下载文件，先清空浏览器缓存再重新访问</li></ol> <p><strong>订单发送到 rabbitmq：</strong></p> <ol><li>添加  rabbitmq 依赖</li> <li>yml 添加 rabbitmq 连接配置</li> <li>配置使用的队列的参数：
orderQueue，持久，非独占，不自动删除
<ul><li>使用 spring 的 Queue 对象，来封装队列参数</li></ul></li> <li>修改 OrderServiceImipl ，完成订单发送
<ul><li>注入 AmqpTemplate 工具对象</li> <li>调用它的 convertAndSend() 方法，发送订单
<ul><li>这个方法，把订单对象自动序列化变成 byte[] 数组再发送</li></ul></li></ul></li></ol> <h2 id="分布式事务"><a href="#分布式事务" class="header-anchor">#</a> 分布式事务</h2> <h3 id="业务案例"><a href="#业务案例" class="header-anchor">#</a> 业务案例</h3> <ol><li>pom.xml 继承 order-parent</li> <li>yml
<ul><li>app.name</li> <li>port</li> <li>eureka</li> <li>datasource</li> <li>mybatis</li> <li>sql语句日志</li></ul></li> <li>实体类</li> <li>Mapper</li> <li>Service</li> <li>Controller</li></ol> <h3 id="全局唯一id发号器"><a href="#全局唯一id发号器" class="header-anchor">#</a> 全局唯一id发号器</h3> <ol><li>解压到 seata-at 目录</li> <li>文件夹改名：<code>easy-id-generator</code></li> <li>pom.xml 拖拽到 idea，修改springboot版本：2.3.2.RELEASE</li> <li>代码中右键--add as maven project</li> <li>添加 <code>bootstrap.yml</code></li> <li><code>application.yml</code> 添加 eureka 配置、app.name</li> <li>配置 id 生成算法开关：
<ul><li>雪花算法 -- <strong>false</strong></li> <li>segment -- <strong>true</strong> -- 根据库表中记录的参数来生成id</li></ul></li> <li>配置数据库连接</li></ol> <h3 id="订单调用发号器、库存、账户"><a href="#订单调用发号器、库存、账户" class="header-anchor">#</a> 订单调用发号器、库存、账户</h3> <ol><li>启动类添加 <code>@EnableFeignClients</code></li> <li>定义三个远程调用接口：
<ul><li>AccountClient</li> <li>StorageClient</li> <li>EasyIdClient</li></ul></li> <li>OrderServiceImpl 中完成远程调用</li></ol> <h2 id="分布式事务-2"><a href="#分布式事务-2" class="header-anchor">#</a> 分布式事务</h2> <h3 id="seata"><a href="#seata" class="header-anchor">#</a> seata</h3> <ul><li>阿里的开源项目</li> <li>一站式分布式事务解决方案</li> <li>支持的事务方案
<ul><li>XA</li> <li>SAGA</li> <li><strong>AT</strong></li> <li><strong>TCC</strong></li></ul></li></ul> <h3 id="seata-at-事务"><a href="#seata-at-事务" class="header-anchor">#</a> seata at 事务</h3> <h5 id="启动事务协调器-tc"><a href="#启动事务协调器-tc" class="header-anchor">#</a> 启动事务协调器（TC）</h5> <ol><li>从 seata 官网下载 seata server（TC）</li> <li>解压</li> <li>修改三个配置文件
<ul><li><strong>regiestry.conf</strong>
向eureka注册</li> <li><strong>file.conf</strong>
seata server运行日志的存储位置</li> <li><strong>seata-server.bat</strong>
使用的内存
苹果电脑修改 seata-server.sh</li></ul></li> <li>cmd 中运行 seata-server.bat</li> <li>访问注册表，查看有没有 seata-server</li></ol> <ul><li>jdk必须是1.8</li> <li>seata server 命令窗口不能关闭</li> <li>抽口中不能选中</li></ul> <h5 id="三个业务模块中添加-seata-at-事务配置"><a href="#三个业务模块中添加-seata-at-事务配置" class="header-anchor">#</a> 三个业务模块中添加 seata at 事务配置</h5> <ol><li>seata 依赖</li> <li>三个配置文件
<ul><li><strong>application.yml</strong>
对事务组命名</li> <li><strong>registry.conf</strong>
连接eureka，获取 seata server （TC）的地址</li> <li><strong>file.conf</strong>
事务组对应使用的协调器</li></ul></li> <li>定一个自动配置类，创建数据源代理对象</li> <li>业务方法上添加注解
<ul><li>@Transactional --  控制本地数据库事务（和全局事务无关）</li> <li>@GlobalTransactional --  启动全局事务，只在第一个模块添加</li></ul></li></ol> <h3 id="tcc-事务方案"><a href="#tcc-事务方案" class="header-anchor">#</a> TCC 事务方案</h3> <p>两个阶段的三种操作：</p> <ul><li>第一个阶段：
<ul><li><strong>Try</strong>
预留资源，冻结数据</li></ul></li> <li>第二个阶段：
<ul><li><strong>Confirm</strong>
确认资源，使用第一阶段冻结的数据，完成业务</li> <li><strong>Cancel</strong>
取消资源，把第一阶段冻结的数据，再恢复回去</li></ul></li></ul> <p>有侵入的事务方案，所有数据操作都需要自己实现，之前学的业务代码需要调整，底层数据库表结构也要调整。</p> <p>有些复杂情况下，AT事务方案无法自动进行事务控制，就需要手动控制的事务方案。</p> <h5 id="新建工程-导入无事务版本"><a href="#新建工程-导入无事务版本" class="header-anchor">#</a> 新建工程，导入无事务版本</h5> <ol><li>新建 Empty project 工程： seata-tcc</li> <li>seata-at/无事务版本.zip
解压缩到 seata-tcc 工程目录</li> <li>double shift --- action -- 搜索add maven project</li> <li>选择 order-parent 的 pom.xml 导入</li></ol> <h5 id="添加-tcc-事务"><a href="#添加-tcc-事务" class="header-anchor">#</a> 添加 TCC  事务</h5> <ol><li>seata 依赖</li> <li>三个配置文件
<ul><li><strong>application.yml</strong>
对事务组命名</li> <li><strong>registry.conf</strong>
连接eureka，获取 seata server （TC）的地址</li> <li><strong>file.conf</strong>
事务组对应使用的协调器</li></ul></li> <li>调整数据库表结构</li> <li>Mapper 添加新的数据库操作</li> <li>ResultHolder，幂等性控制</li> <li>按 seata tcc 的规则，定义 TccAction 接口、实现
用来执行 TCC 三个操作</li> <li>TccAction 的三个方法要添加 @Transactional，控制本地事务（和全局事务无关）</li> <li>业务方法中，不再直接执行业务，要改成调用 TccAction 的第一阶段方法，冻结数据</li> <li>第一个模块业务方法上添加 @GlobalTransactional</li></ol> <p>TCC 的三个方法，</p> <ul><li>第一阶段方法，需要手动调用</li> <li>第二阶段方法，由 seata 的 RM 组件（资源管理器）接收TC指令，然后自动执行</li></ul> <h5 id="tcc的两个问题"><a href="#tcc的两个问题" class="header-anchor">#</a> TCC的两个问题</h5> <ul><li><p>第一阶段冻结数据失败，第二阶段仍然会执行回滚，可能引起数据混乱</p></li> <li><p>第二阶段，如果运行超时或出错，TC会重试执行第二阶段，</p> <p>可能会重复的提交数据，或重复的回滚数据，造成数据混乱。</p></li></ul> <h5 id="幂等性控制"><a href="#幂等性控制" class="header-anchor">#</a> 幂等性控制</h5> <p>一次操作成功，和多次操作的结果相同</p> <h2 id="rocketmq"><a href="#rocketmq" class="header-anchor">#</a> Rocketmq</h2> <h3 id="搭建服务器"><a href="#搭建服务器" class="header-anchor">#</a> 搭建服务器</h3> <ol><li><p>克隆 centos-8-2105：rocketmq</p></li> <li><p>设置ip:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ip-static
ip: <span class="token number">192.168</span>.64.141

<span class="token function">ifconfig</span>
<span class="token comment"># 如果ip设置失败，参考上面 vmware ip设置</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>上传文件到 /root/</p> <ul><li>分布式事务\rocketmq\
<ul><li>jdk-8u212-linux-x64.tar.gz</li> <li>rocketmq-all-4.9.2-bin-release.zip</li> <li>rocketmq-dashboard-1.0.1-SNAPSHOT.jar</li></ul></li></ul></li> <li><p>根据csdn笔记，搭建rocketmq：<a href="https://wanght.blog.csdn.net/article/details/106963070" target="_blank" rel="noopener noreferrer">RocketMQ (一) 安装<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>所有文件下载都不用执行</li></ul></li></ol> <h3 id="rocketmq启动命令"><a href="#rocketmq启动命令" class="header-anchor">#</a> Rocketmq启动命令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/

<span class="token comment">#启动name server</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&amp;</span>

<span class="token comment">#启动broker</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqbroker -n localhost:9876 <span class="token operator">&amp;</span>

<span class="token comment">#如果需要从配置文件启动 broker：</span>
<span class="token comment">#nohup sh bin/mqbroker -n localhost:9876 -c conf/broker.conf &amp;</span>



<span class="token comment">#切换到主目录</span>
<span class="token builtin class-name">cd</span> ~/

<span class="token comment">#启动管理界面</span>
<span class="token function">nohup</span> java -jar rocketmq-dashboard-1.0.1-SNAPSHOT.jar --server.port<span class="token operator">=</span><span class="token number">8080</span> --rocketmq.config.namesrvAddr<span class="token operator">=</span>localhost:9876 <span class="token operator">&amp;</span>

<span class="token comment">#查看进程，要包含：name server、broker、jar</span>
jps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="rocketmq-收发消息api"><a href="#rocketmq-收发消息api" class="header-anchor">#</a> Rocketmq  收发消息api</h3> <ol><li>新建Empty project工程： rocketmq-dtx</li> <li>新建 maven 模块： rocketmq-api</li> <li>添加 rocketmq 依赖，从 rocketmq(四) 笔记复制</li> <li>测试消息收发方式：
<ul><li>同步消息</li> <li>延时消息</li> <li>顺序消息</li> <li>事务消息</li></ul></li></ol> <h3 id="可靠消息最终一致性事务"><a href="#可靠消息最终一致性事务" class="header-anchor">#</a> 可靠消息最终一致性事务</h3> <p>用Rocketmq的事务消息实现</p> <h5 id="导入项目"><a href="#导入项目" class="header-anchor">#</a> 导入项目</h5> <ol><li>seata-at\无事务版本.zip
解压缩到 rocketmq-dtx 工程目录</li> <li>导入 order-parent\pom.xml</li> <li>检查项目jdk和语言版本</li></ol> <h5 id="添加可靠消息最终一致性事务"><a href="#添加可靠消息最终一致性事务" class="header-anchor">#</a> 添加可靠消息最终一致性事务</h5> <ul><li><p>订单 ----&gt; 账户</p></li> <li><p>用消息服务做异步调用</p></li> <li><p><strong>修改订单</strong></p></li></ul> <ol><li><p>父项目pom.xml添加rocketmq依赖</p></li> <li><p>application.yml</p> <ul><li>name server 地址</li> <li>生产者组的组名</li></ul></li> <li><p>添加数据库表tx_table，用来存储本地事务的执行状态</p></li> <li><p>添加实体类 tx_info</p></li> <li><p>添加 TxMapper</p></li> <li><p>用来封装消息数据的工具：  AccountMessage(userId, money, xid)</p></li> <li><p>JsonUtil</p></li> <li><p>修改 OrderServiceImpl</p> <ul><li>业务方法中发送事务消息</li> <li>在监听器中执行本地事务、处理事务状态回查</li></ul></li></ol> <ul><li><strong>修改账户，接收消息执行账户扣减</strong></li></ul> <ol><li>yml配置
<ul><li>name server</li></ul></li> <li>AccountMessage</li> <li>JsonUtil</li> <li>新建消费者类：AccountConsumer</li> <li>用注解配置接收消息</li> <li>调用业务方法 AccountService.decrease() 完成金额扣减</li></ol> <h2 id="devops-开发运维一体化"><a href="#devops-开发运维一体化" class="header-anchor">#</a> DevOps 开发运维一体化</h2> <ul><li>一部分运维工作，要交给开发做</li> <li>开发人员在Docker容器中部署自己的应用运行环境</li></ul> <h3 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h3> <p>为什么使用Docker</p> <ol><li>提高开发-测试-运维流程效率</li> <li>在服务器上可以大量部署Docker容器，充分发挥服务器的运算能力</li></ol> <p>什么时候使用</p> <p>以后部署应用，都要使用Docker部署</p> <p>Docker基本概念</p> <ul><li>镜像</li> <li>容器</li></ul> <p>Docker服务器</p> <ol><li><p>克隆 docker-base： docker</p></li> <li><p>设置ip</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ip-static
ip: <span class="token number">192.168</span>.64.150

<span class="token function">ifconfig</span>
<span class="token comment"># 如果设置ip失败，参考上面vmware笔记</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>上传文件到 /root/：</p> <ul><li>docker-images.gz</li> <li>tomcat文件夹</li></ul></li> <li><p>导入镜像： <code>docker load -i docker-images.gz</code></p></li></ol> <h2 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> Elasticsearch</h2> <h3 id="搭建-es-服务器"><a href="#搭建-es-服务器" class="header-anchor">#</a> 搭建 ES 服务器</h3> <ol><li><p>克隆 docker-base： es</p></li> <li><p>设置虚拟机内存：右键点es虚拟机 --- 设置 --- 内存设置成2G</p></li> <li><p>设置ip:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ip-static
ip: <span class="token number">192.168</span>.64.181

<span class="token function">ifconfig</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>上传文件到 /root/</p> <ul><li>pditems 文件夹</li> <li>elasticsearch-analysis-ik-7.9.3.zip</li> <li>es-img.gz</li></ul></li> <li><p>导入镜像： <code>docker load -i es-img.gz</code></p></li> <li><p>重启docker系统服务：<code>systemctl restart docker</code></p></li> <li><p>设置一个系统的底层参数，重启服务器：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">'vm.max_map_count=262144'</span> <span class="token operator">&gt;&gt;</span>/etc/sysctl.conf

<span class="token function">shutdown</span> -r now
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>按照 csdn笔记启动 es 容器：<a href="https://wanght.blog.csdn.net/article/details/109145574" target="_blank" rel="noopener noreferrer">Elasticsearch（一）Docker搭建ES集群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/matheusblog/assets/img/image-20220411173130250.e5c2e700.png" alt="image-20220411173130250"></p></li></ol> <h3 id="拼多商城搜索条"><a href="#拼多商城搜索条" class="header-anchor">#</a> 拼多商城搜索条</h3> <ol><li>添加 elasticsearch 依赖</li> <li>yml配置es服务器地址</li> <li>新建实体类 Item，用来封装 pditems 索引中的数据</li> <li>定义 ItemRepository 数据访问接口</li> <li>添加搜索方法： findByTitleOrSellPoint()
<ul><li>分页</li> <li>高亮</li></ul></li> <li>SearchService</li> <li>SearchController</li> <li>search.jsp</li></ol> <h3 id="kubernetes"><a href="#kubernetes" class="header-anchor">#</a> Kubernetes</h3> <ul><li>容器的自动部署管理工具</li> <li>谷歌的开源工具</li> <li>缩写 K8s 或 Kube</li></ul> <h3 id="安装搭建-k8s-集群"><a href="#安装搭建-k8s-集群" class="header-anchor">#</a> 安装搭建 K8s 集群</h3> <p>辅助安装k8s几群的开源工具：</p> <ul><li>一键安装脚本</li> <li>一步一步手动安装</li></ul> <h5 id="集群方案"><a href="#集群方案" class="header-anchor">#</a> 集群方案</h5> <ul><li>三台服务器 -- 16G或以上内存</li> <li>两台服务器 -- 8G</li></ul> <h5 id="安装集群"><a href="#安装集群" class="header-anchor">#</a> 安装集群</h5> <h5 id=""><a href="#" class="header-anchor">#</a></h5> <ol><li><p>克隆 centos-8-2105：k1</p></li> <li><p>设置ip</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ip-static 
ip: <span class="token number">192.168</span>.64.191

<span class="token function">ifconfig</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>上传文件</p></li></ol> <ul><li>DevOps课前资料\kubernetes\
<ul><li>images.gz 传到 <code>/root/</code></li> <li>kubeasz-3.1.0.zip解压缩
<ul><li>kubeasz-3.1.0/<code>ezdown</code> 传到 <code>/root/</code></li> <li>kubeasz-3.1.0/<code>kubeasz文件夹</code> 传到 <code>/etc/</code></li></ul></li></ul></li></ul> <ol start="4"><li><p>设置内存和cpu</p> <ol><li>右键点虚拟机 --- 设置</li> <li>内存 2G+</li> <li>cpu 2块</li> <li>重启服务器：<code>shutdown -r now</code></li></ol></li> <li><p>安装docker</p></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 脚本文件添加执行权限</span>
<span class="token function">chmod</span> +x ./ezdown

<span class="token comment"># 下载所有的离线安装文件，如果文件存在不会重复下载</span>
<span class="token comment"># 执行脚本文件安装docker</span>
./ezdown -D

<span class="token comment"># 确认docker安装成功</span>
<span class="token function">docker</span> info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="6"><li><p>导入测试用的镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> load -i images.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>k1关机，再从 k1 克隆： k2、k3</p> <ul><li>设置k2和k3的ip：
<ul><li>192.168.64.192</li> <li>192.168.64.193</li></ul></li></ul></li> <li><p>启动安装集群过程中使用的临时容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./ezdown -S
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>安装方式设置成离线安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sed</span> -i <span class="token string">'s/^INSTALL_SOURCE.*$/INSTALL_SOURCE: &quot;offline&quot;/g'</span> /etc/kubeasz/example/config.yml 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置 191 免密登录192和193</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 生成公钥和私钥</span>
ssh-keygen -t rsa -b <span class="token number">2048</span> -N <span class="token string">''</span> -f ~/.ssh/id_rsa

<span class="token comment"># 公钥复制到所有服务器</span>
ssh-copy-id <span class="token number">192.168</span>.64.191

ssh-copy-id <span class="token number">192.168</span>.64.192

ssh-copy-id <span class="token number">192.168</span>.64.193
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>创建集群方案的配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /etc/kubeasz

<span class="token function">chmod</span> +x ezctl

<span class="token comment"># 新建方案 cs1，会新建cs1文件夹，复制默认的样例配置到cs1文件夹下</span>
./ezctl new cs1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>编辑 cs1 方案的 hosts 文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/kubeasz/clusters/cs1/hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/matheusblog/assets/img/image-20220413154817590.9773bb2e.png" alt="image-20220413154817590"></p></li> <li><p>三台服务器拍摄快照，保留当前服务器状态
如果集群安装失败可以恢复到快照状态重新安装</p> <ul><li>可以关闭其他无关应用释放内存</li> <li>或者重启电脑释放内存</li> <li>或者适当增加虚拟机内存</li></ul></li> <li><p>执行一键安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /etc/kubeasz

./ezctl setup cs1 all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h3 id="k8s三个核心概念"><a href="#k8s三个核心概念" class="header-anchor">#</a> K8s三个核心概念</h3> <ul><li>Pod
是Docker容器的封装对象</li> <li>控制器
用来自动部署或销毁容器</li> <li>Service
不变的访问地址</li></ul> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <h3 id="spring-cloud-netflix-2"><a href="#spring-cloud-netflix-2" class="header-anchor">#</a> Spring cloud Netflix</h3> <ul><li>注册中心 -- eureka，nacos</li> <li>配置中心 -- spring cloud config，nacos</li> <li>API网关 -- zuul，gateway</li> <li>远程调用、负载均衡 -- feign、ribbon，dubbo</li> <li>容错、限流 -- hystrix，sentinel</li> <li>数据监控
<ul><li>hystrix dashboard + turbine，错误监控，sentinel</li> <li>sleuth + zipkin，链路监控</li></ul></li></ul> <h3 id="消息服务"><a href="#消息服务" class="header-anchor">#</a> 消息服务</h3> <ul><li><p>使用场景：解耦、削峰、异步调用</p></li> <li><p>具体项目案例：</p> <ul><li>BUS配置刷新</li> <li>Sleuth+Zipkin链路跟踪日志</li> <li>订单的流量削峰</li> <li>Rocketmq的可靠消息最终一致性事务</li></ul></li> <li><p>Rabbitmq</p> <ul><li>六种模式：简单，工作，发布和订阅，路由，主题，RPC</li></ul></li> <li><p>Rocketmq</p> <ul><li>延时、顺序、事务</li></ul></li></ul> <h3 id="分布式事务-3"><a href="#分布式事务-3" class="header-anchor">#</a> 分布式事务</h3> <ul><li>Seata
<ul><li>AT -- 80%场景使用AT事务</li> <li>TCC</li></ul></li> <li>Rocketmq 的可靠消息最终一致性事务
<ul><li>场景：使用消息服务做异步调用</li></ul></li></ul> <h3 id="devops"><a href="#devops" class="header-anchor">#</a> DevOps</h3> <ul><li>Docker</li> <li>Kubernetes</li></ul> <h3 id="elasticsearch-2"><a href="#elasticsearch-2" class="header-anchor">#</a> Elasticsearch</h3> <ul><li><p>倒排索引</p></li> <li><p>概念：索引、分片、副本、映射、类别、文档、字段</p></li> <li><p>Spring data elasticsearch -- Repository</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/matheusblog/md/springcloud/mq/01RabbitMQ.html">
        RabbitMQ
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/matheusblog/assets/js/app.617ede8e.js" defer></script><script src="/matheusblog/assets/js/3.1edc7715.js" defer></script><script src="/matheusblog/assets/js/98.ba771394.js" defer></script>
  </body>
</html>
