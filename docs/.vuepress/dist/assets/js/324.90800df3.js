(window.webpackJsonp=window.webpackJsonp||[]).push([[324],{1721:function(s,a,e){"use strict";e.r(a);var t=e(65),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"rocketmq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq"}},[s._v("#")]),s._v(" RocketMQ")]),s._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#文件下载"}},[s._v("文件下载")])]),e("li",[e("a",{attrs:{href:"#安装"}},[s._v("安装")]),e("ul",[e("li",[e("a",{attrs:{href:"#安装配置-jdk8"}},[s._v("安装配置 jdk8")])]),e("li",[e("a",{attrs:{href:"#安装rocketmq"}},[s._v("安装RocketMQ")])])])]),e("li",[e("a",{attrs:{href:"#测试"}},[s._v("测试")])]),e("li",[e("a",{attrs:{href:"#rocketmq-的关闭命令"}},[s._v("RocketMQ 的关闭命令")]),e("ul",[e("li",[e("a",{attrs:{href:"#关闭-broker"}},[s._v("关闭 broker")])]),e("li",[e("a",{attrs:{href:"#关闭-nameserver"}},[s._v("关闭 nameserver")])])])]),e("li",[e("a",{attrs:{href:"#管理界面"}},[s._v("管理界面")])]),e("li",[e("a",{attrs:{href:"#收发消息出现超时问题"}},[s._v("收发消息出现超时问题")])]),e("li",[e("a",{attrs:{href:"#部署环境"}},[s._v("部署环境")])]),e("li",[e("a",{attrs:{href:"#安装rocketmq"}},[s._v("安装Rocketmq")])]),e("li",[e("a",{attrs:{href:"#建文件夹"}},[s._v("建文件夹")])]),e("li",[e("a",{attrs:{href:"#配置"}},[s._v("配置")]),e("ul",[e("li",[e("a",{attrs:{href:"#_1-broker-a-a主服务器配置"}},[s._v("1. broker-a，a主服务器配置")])]),e("li",[e("a",{attrs:{href:"#_2-broker-a-slave-a从服务器配置"}},[s._v("2. broker-a slave，a从服务器配置")])]),e("li",[e("a",{attrs:{href:"#_3-broker-b-b主服务器配置"}},[s._v("3. broker-b，b主服务器配置")])]),e("li",[e("a",{attrs:{href:"#_4-broker-b-slave-b从服务器配置"}},[s._v("4. broker-b slave，b从服务器配置")])]),e("li",[e("a",{attrs:{href:"#配置要点说明"}},[s._v("配置要点说明")])])])]),e("li",[e("a",{attrs:{href:"#启动"}},[s._v("启动")]),e("ul",[e("li",[e("a",{attrs:{href:"#_1-启动两个-name-server"}},[s._v("1. 启动两个 name server")])]),e("li",[e("a",{attrs:{href:"#_2-启动-broker-a-的主从两台服务器"}},[s._v("2. 启动 broker a 的主从两台服务器")])]),e("li",[e("a",{attrs:{href:"#_3-启动-broker-b-的主从两台服务器"}},[s._v("3. 启动 broker b 的主从两台服务器")])])])]),e("li",[e("a",{attrs:{href:"#检查启动的服务"}},[s._v("检查启动的服务")])]),e("li",[e("a",{attrs:{href:"#启动管理界面"}},[s._v("启动管理界面")])]),e("li",[e("a",{attrs:{href:"#topic-基本原理"}},[s._v("Topic 基本原理")]),e("ul",[e("li",[e("a",{attrs:{href:"#在rocketmq集群中新建-topic1"}},[s._v("在Rocketmq集群中新建 Topic1")])]),e("li",[e("a",{attrs:{href:"#perm-参数的含义"}},[s._v("perm 参数的含义")])]),e("li",[e("a",{attrs:{href:"#topic-收发消息原理"}},[s._v("Topic 收发消息原理")])]),e("li",[e("a",{attrs:{href:"#生产者的负载均衡"}},[s._v("生产者的负载均衡")])]),e("li",[e("a",{attrs:{href:"#消费者的负载均衡"}},[s._v("消费者的负载均衡")])]),e("li",[e("a",{attrs:{href:"#问题"}},[s._v("问题")])])])]),e("li",[e("a",{attrs:{href:"#nameserver-基本原理"}},[s._v("NameServer 基本原理")]),e("ul",[e("li",[e("a",{attrs:{href:"#基本认识"}},[s._v("基本认识")])]),e("li",[e("a",{attrs:{href:"#broker、producer、consumer-与nameserver的通信"}},[s._v("Broker、Producer、Consumer 与NameServer的通信")])])])])])]),e("p"),s._v(" "),e("h2",{attrs:{id:"文件下载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文件下载"}},[s._v("#")]),s._v(" 文件下载")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://download.csdn.net/download/weixin_38305440/12552021",target:"_blank",rel:"noopener noreferrer"}},[s._v("jdk-8-u212"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://download.csdn.net/download/weixin_38305440/12552334",target:"_blank",rel:"noopener noreferrer"}},[s._v("rocketmq4.7-rocketconsole1.0.1"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("h3",{attrs:{id:"安装配置-jdk8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装配置-jdk8"}},[s._v("#")]),s._v(" 安装配置 jdk8")]),s._v(" "),e("p",[e("strong",[s._v("1. 上传jdk压缩文件")])]),s._v(" "),e("p",[s._v("将文件"),e("code",[s._v("jdk-8u212-linux-x64.tar.gz")]),s._v("上传到 /root 目录")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200625220008838.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"jdk"}})]),s._v(" "),e("p",[e("strong",[s._v("2. 解压缩")])]),s._v(" "),e("p",[s._v("执行解压命令")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将jdk解压到 /usr/local/ 目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xf jdk-8u212-linux-x64.tar.gz -C /usr/local/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换到 /usr/local/ 目录, 显示列表, 查看解压缩的jdk目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local\nll\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("strong",[s._v("3. 配置环境变量")])]),s._v(" "),e("p",[s._v("修改 /etc/profile 配置文件, 配置环境变量")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在文件末尾添加以下内容:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/jdk1.8.0_212\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("修改完后, 让环境变量立即生效")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("4. 验证")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("java -version\n\n----------------------------------------------------------------\njava version "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.8.0_212"')]),s._v("\nJava"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" SE Runtime Environment "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(".0_212-b10"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nJava HotSpot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.212")]),s._v("-b10, mixed mode"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\njavac -version\n\n---------------\njavac "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(".0_212\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"安装rocketmq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装rocketmq"}},[s._v("#")]),s._v(" 安装RocketMQ")]),s._v(" "),e("h4",{attrs:{id:"_1-下载-rocketmq-二进制文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载-rocketmq-二进制文件"}},[s._v("#")]),s._v(" 1. 下载 rocketmq 二进制文件")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" --no-check-certificate https://dlcdn.apache.org/rocketmq/4.9.2/rocketmq-all-4.9.2-bin-release.zip\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_2-解压缩-rocketmq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-解压缩-rocketmq"}},[s._v("#")]),s._v(" 2. 解压缩 rocketmq")]),s._v(" "),e("p",[s._v("将 rocketmq 解压到 /usr/local/ 目录")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" rocketmq-all-4.9.2-bin-release.zip -d /usr/local/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改一下文件夹名，改成 rocketmq 方便使用")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/local/rocketmq-4.9.2 /usr/local/rocketmq\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h4",{attrs:{id:"_3-配置环境变量-rocketmq-home-和-path"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置环境变量-rocketmq-home-和-path"}},[s._v("#")]),s._v(" 3. 配置环境变量 ROCKETMQ_HOME 和 PATH")]),s._v(" "),e("p",[s._v("为了后续操作方便可以配置环境变量，之后在任意位置都可以执行rocketmq的操作命令。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在文件末尾添加以下内容:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROCKETMQ_HOME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROCKETMQ_HOME")]),s._v("/bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("修改完后, 让环境变量立即生效")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_4-减小-rocketmq-使用的内存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-减小-rocketmq-使用的内存"}},[s._v("#")]),s._v(" 4. 减小 rocketmq 使用的内存")]),s._v(" "),e("p",[s._v("rocketmq需要启动两个服务: "),e("code",[s._v("name server")]),s._v(" 和 "),e("code",[s._v("broker")]),s._v(", "),e("code",[s._v("name server")]),s._v(" 默认配置JVM使用的内存是4g, "),e("code",[s._v("broker")]),s._v("默认配置JVM使用的内存是8g.")]),s._v(" "),e("p",[s._v("开发环境中如果内存不足, 服务可能会无法启动, 可以通过降低两个服务的内存, 使服务可以正常启动, 也可以节省内存.")]),s._v(" "),e("p",[e("strong",[s._v("修改 "),e("code",[s._v("name server")]),s._v(" 内存改为 256m")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 bin/runserver.sh")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" bin/runserver.sh\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到文件中下面这一行:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 -Xms4g -Xmx4g -Xmn2g 修改为 -Xms256m -Xmx256m -Xmn128m")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[e("strong",[s._v("修改 "),e("code",[s._v("broker")]),s._v(" 内存改为 256m")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 bin/runbroker.sh")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" bin/runbroker.sh\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到文件中下面这一行:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms8g -Xmx8g"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 -Xms8g -Xmx8g -Xmn4g 修改为 -Xms256m -Xmx256m")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms256m -Xmx256m"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h4",{attrs:{id:"_5-启动-rocketmq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动-rocketmq"}},[s._v("#")]),s._v(" 5. 启动 rocketmq")]),s._v(" "),e("p",[s._v("先启动 "),e("code",[s._v("name server")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 rocketmq 目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 name server")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" bin/mqnamesrv "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 查看运行日志, 看到"The Name Server boot success."表示启动成功')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f ~/logs/rocketmqlogs/namesrv.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("再启动 "),e("code",[s._v("broker")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 broker, 连接name server: localhost:9876")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" bin/mqbroker -n localhost:9876 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 查看运行日志, 看到"The broker[......:10911] boot success."表示启动成功')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f ~/logs/rocketmqlogs/broker.log \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h4",{attrs:{id:"_6-关闭防火墙"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-关闭防火墙"}},[s._v("#")]),s._v(" 6. 关闭防火墙")]),s._v(" "),e("p",[s._v("rocketmq的通信会用到多个端口, 为了方便测试我们关闭防火墙")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl stop firewalld.service\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止防火墙开机启动")]),s._v("\nsystemctl disable firewalld.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),e("p",[s._v("运行测试, 启动生产者发送消息, 启动消费者接收消息")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过环境变量, 告诉客户端程序name server的地址")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAMESRV_ADDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost:9876\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动生产者来测试发送消息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" bin/tools.sh org.apache.rocketmq.example.quickstart.Producer\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动消费者来测试接收消息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"rocketmq-的关闭命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-的关闭命令"}},[s._v("#")]),s._v(" RocketMQ 的关闭命令")]),s._v(" "),e("h3",{attrs:{id:"关闭-broker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭-broker"}},[s._v("#")]),s._v(" 关闭 broker")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mqshutdown broker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"关闭-nameserver"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭-nameserver"}},[s._v("#")]),s._v(" 关闭 nameserver")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mqshutdown namesrv\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"管理界面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#管理界面"}},[s._v("#")]),s._v(" 管理界面")]),s._v(" "),e("p",[s._v("在开源项目 "),e("code",[s._v("rocketmq-dashboard")]),s._v(" 中提供了rocketmq 的管理界面: 地址为: https://github.com/apache/rocketmq-dashboard")]),s._v(" "),e("p",[s._v("github 在国内访问缓慢, 也可以使用码云的镜像项目, 地址为: https://gitee.com/mirrors_apache/rocketmq-dashboard")]),s._v(" "),e("p",[e("strong",[s._v("1. 克隆项目")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 克隆 rocketmq-dashboard 项目")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://gitee.com/mirrors_apache/rocketmq-dashboard\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("2. maven打包管理界面项目")])]),s._v(" "),e("p",[e("strong",[s._v("如果没有安装 maven，请先安装")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 maven")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" --no-check-certificate https://dlcdn.apache.org/maven/maven-3/3.8.4/binaries/apache-maven-3.8.4-bin.tar.gz\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf apache-maven-3.8.4-bin.tar.gz -C /usr/local/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置环境变量")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),e("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/profile.d/mvn.sh")]),s._v("\nexport PATH=/usr/local/apache-maven-3.8.4/bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\nEOF")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让环境变量生效")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile.d/mvn.sh\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查 maven 是否可运行")]),s._v("\nmvn -version\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("打包管理界面项目 "),e("code",[s._v("rocketmq-dashboard")]),s._v(".\n打包过程中会下载各种依赖,比较缓慢,请耐心等待")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入管理界面项目的文件夹")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" rocketmq-dashboard\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行maven 打包命令, 执行时间较长, 请耐心等待")]),s._v("\nmvn clean package -Dmaven.test.skip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("3. 运行启动管理界面")])]),s._v(" "),e("p",[s._v("打包的 jar 文件在 target 目录, 进入目录执行jar文件")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 target 目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" target\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行管理界面")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" java -jar rocketmq-dashboard-1.0.1-SNAPSHOT.jar --server.port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" --rocketmq.config.namesrvAddr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost:9876 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("访问管理界面:")])]),s._v(" "),e("p",[e("a",{attrs:{href:"http://192.168.64.141:8080/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://192.168.64.141:8080"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/2020062600561495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"rocketmq"}})]),s._v(" "),e("h2",{attrs:{id:"收发消息出现超时问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#收发消息出现超时问题"}},[s._v("#")]),s._v(" 收发消息出现超时问题")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" conf/broker.conf\n\n末尾添加\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerIP1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".64.141\n\n关闭 broker 服务\nmqshutdown broker\n\n重新使用 broker.conf 配置启动 broker\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" bin/mqbroker -n localhost:9876 -c conf/broker.conf "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"部署环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署环境"}},[s._v("#")]),s._v(" 部署环境")]),s._v(" "),e("p",[s._v("作为测试环境，我们使用两台虚拟机来部署双主双从环境，具体结构如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709000005103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70",alt:"集群"}})]),s._v(" "),e("p",[s._v("整个集群由"),e("strong",[s._v("两个 name server")]),s._v(" 实例和"),e("strong",[s._v("四个 broker")]),s._v(" 实例组成")]),s._v(" "),e("p",[e("strong",[s._v("name server:")])]),s._v(" "),e("ul",[e("li",[s._v("两台服务器分别启动两个name server")])]),s._v(" "),e("p",[e("strong",[s._v("broker A 主从:")])]),s._v(" "),e("ul",[e("li",[s._v("服务器1部署 broker A 主服务")]),s._v(" "),e("li",[s._v("服务器2部署 broker A 从服务")])]),s._v(" "),e("p",[e("strong",[s._v("broker B 主从:")])]),s._v(" "),e("ul",[e("li",[s._v("服务器2部署 broker B 主服务")]),s._v(" "),e("li",[s._v("服务器1部署 broker B 从服务")])]),s._v(" "),e("h2",{attrs:{id:"安装rocketmq-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装rocketmq-2"}},[s._v("#")]),s._v(" 安装Rocketmq")]),s._v(" "),e("p",[s._v("首先在两台虚拟机上安装 Rocketmq。或在一台虚拟机上装好后进行克隆。")]),s._v(" "),e("h2",{attrs:{id:"建文件夹"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#建文件夹"}},[s._v("#")]),s._v(" 建文件夹")]),s._v(" "),e("p",[s._v("在一台服务器上启动两个 broker 实例，需要为不同实例设置单独的数据存储目录。")]),s._v(" "),e("p",[s._v("为了方便起见，我们在两台服务器上都创建这四个实例所需要的的目录。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-a\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-a/commitlog\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-b\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-b/commitlog\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-as\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-as/commitlog\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-bs\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/rocketmq/store/broker-bs/commitlog\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),e("p",[s._v("在 "),e("code",[s._v("rocketmq/conf")]),s._v(" 目录下提供了四种集群方案的配置样例")]),s._v(" "),e("ul",[e("li",[s._v("2m-2s-async：双主双从异步复制")]),s._v(" "),e("li",[e("strong",[s._v("2m-2s-sync：双主双从同步复制")])]),s._v(" "),e("li",[s._v("2m-noslave：双主")]),s._v(" "),e("li",[s._v("dledger： raft主从切换")])]),s._v(" "),e("p",[s._v("这里我们选择"),e("strong",[s._v("双主双从同步复制")]),s._v("方案。")]),s._v(" "),e("h3",{attrs:{id:"_1-broker-a-a主服务器配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-broker-a-a主服务器配置"}},[s._v("#")]),s._v(" 1. broker-a，a主服务器配置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709142712299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"a"}})]),s._v(" "),e("p",[s._v("在"),e("strong",[s._v("服务器1")]),s._v("修改样例配置文件："),e("code",[s._v("rocketmq/conf/2m-2s-sync/broker-a.properties")])]),s._v(" "),e("p",[s._v("在样例配置文件中，添加三项配置：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("listenPort")]),s._v("：我们在一台服务器上要运行两个broker实例，所以两个实例的端口要有所区分。这里broker-a主服务器的端口使用默认的10911。")]),s._v(" "),e("li",[e("code",[s._v("storePathRootDir")]),s._v("：数据存储目录")]),s._v(" "),e("li",[e("code",[s._v("storePathCommitLog")]),s._v("：提交日志存储目录")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DefaultCluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SYNC_MASTER\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenPort")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathRootDir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-a\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathCommitLog")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-a/commitlog\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"_2-broker-a-slave-a从服务器配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-broker-a-slave-a从服务器配置"}},[s._v("#")]),s._v(" 2. broker-a slave，a从服务器配置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709142816923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"as"}})]),s._v(" "),e("p",[s._v("在"),e("strong",[s._v("服务器2")]),s._v("修改样例配置文件："),e("code",[s._v("rocketmq/conf/2m-2s-sync/broker-a-s.properties")])]),s._v(" "),e("p",[s._v("在样例配置文件中，添加三项配置：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("listenPort")]),s._v("：我们在一台服务器上要运行两个broker实例，所以两个实例的端口要有所区分。这里broker-a slave从服务器的端口使用11911。")]),s._v(" "),e("li",[e("code",[s._v("storePathRootDir")]),s._v("：数据存储目录")]),s._v(" "),e("li",[e("code",[s._v("storePathCommitLog")]),s._v("：提交日志存储目录")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DefaultCluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SLAVE\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenPort")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11911")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathRootDir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-as\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathCommitLog")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-as/commitlog\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"_3-broker-b-b主服务器配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-broker-b-b主服务器配置"}},[s._v("#")]),s._v(" 3. broker-b，b主服务器配置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709142900653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"b"}})]),s._v(" "),e("p",[s._v("在"),e("strong",[s._v("服务器2")]),s._v("修改样例配置文件："),e("code",[s._v("rocketmq/conf/2m-2s-sync/broker-b.properties")])]),s._v(" "),e("p",[s._v("在样例配置文件中，添加三项配置：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("listenPort")]),s._v("：我们在一台服务器上要运行两个broker实例，所以两个实例的端口要有所区分。这里broker-b主服务器的端口使用默认的10911。")]),s._v(" "),e("li",[e("code",[s._v("storePathRootDir")]),s._v("：数据存储目录")]),s._v(" "),e("li",[e("code",[s._v("storePathCommitLog")]),s._v("：提交日志存储目录")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DefaultCluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-b\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SYNC_MASTER\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenPort")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathRootDir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-b\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathCommitLog")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-b/commitlog\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"_4-broker-b-slave-b从服务器配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-broker-b-slave-b从服务器配置"}},[s._v("#")]),s._v(" 4. broker-b slave，b从服务器配置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709142929917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"bs"}})]),s._v(" "),e("p",[s._v("在"),e("strong",[s._v("服务器1")]),s._v("修改样例配置文件："),e("code",[s._v("rocketmq/conf/2m-2s-sync/broker-b-s.properties")])]),s._v(" "),e("p",[s._v("在样例配置文件中，添加三项配置：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("listenPort")]),s._v("：我们在一台服务器上要运行两个broker实例，所以两个实例的端口要有所区分。这里broker-b slave从服务器的端口使用11911。")]),s._v(" "),e("li",[e("code",[s._v("storePathRootDir")]),s._v("：数据存储目录")]),s._v(" "),e("li",[e("code",[s._v("storePathCommitLog")]),s._v("：提交日志存储目录")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DefaultCluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-b\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SLAVE\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenPort")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11911")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathRootDir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-bs\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathCommitLog")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/rocketmq/store/broker-bs/commitlog\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"配置要点说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置要点说明"}},[s._v("#")]),s._v(" 配置要点说明")]),s._v(" "),e("ol",[e("li",[s._v("四台服务器的集群名 "),e("code",[s._v("brokerClusterName")]),s._v(" 相同。集群名称相同的服务器共同组成服务集群 。")]),s._v(" "),e("li",[s._v("从服务器通过名字与主服务器关联在一起，"),e("code",[s._v("brokerName")]),s._v(" 与主服务器相同。")]),s._v(" "),e("li",[e("code",[s._v("brokerId")]),s._v("为0是主服务器。从服务器的值是非零值，例如如果有四个从服务器，他们的 "),e("code",[s._v("brokerId")]),s._v(" 应该是 1,2,3,4。")]),s._v(" "),e("li",[e("code",[s._v("brokerRole")]),s._v("的值为 "),e("code",[s._v("SYNC_MASTER")]),s._v(" 是同步复制的主服务器。如果是 "),e("code",[s._v("ASYNC_MASTER")]),s._v(" 则为异步复制的主服务器。")])]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("同步复制")]),s._v("：消息复制到从服务器后才向生产者发回反馈信息。")]),s._v(" "),e("li",[e("strong",[s._v("异步复制")]),s._v("：消息发到主服务器就向生产者发回反馈信息，之后再向从服务器复制。")])]),s._v(" "),e("h2",{attrs:{id:"启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),e("h3",{attrs:{id:"_1-启动两个-name-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动两个-name-server"}},[s._v("#")]),s._v(" 1. 启动两个 name server")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709143211216.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"namesrv"}})]),s._v(" "),e("p",[s._v("在两台服务器上启动两个 name server，它们不用做任何集群的配置，都是作为独立服务运行，它们之间也不会进行数据复制。")]),s._v(" "),e("p",[s._v("所有broker服务启动后，要同时连接这两个 name server，向两个 name server 进行注册。")]),s._v(" "),e("p",[e("strong",[s._v("在两台服务器上都启动 name server")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqnamesrv "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-启动-broker-a-的主从两台服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动-broker-a-的主从两台服务器"}},[s._v("#")]),s._v(" 2. 启动 broker a 的主从两台服务器")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709144521933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"a"}})]),s._v(" "),e("p",[e("strong",[s._v("在服务器1上启动 broker a 主服务器")]),s._v("：")]),s._v(" "),e("p",[s._v("参数说明：")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("-n参数")]),s._v("：指定name server地址列表，多个地址用分号分隔")]),s._v(" "),e("li",[e("strong",[s._v("-c参数")]),s._v("：指定配置文件，使用指定的配置文件启动 broker")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.64.151:9876;192.168.64.152:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-c "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROCKETMQ_HOME")]),s._v("/conf/2m-2s-sync/broker-a.properties "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("在服务器2上启动 broker a 从服务器")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.64.151:9876;192.168.64.152:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-c "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROCKETMQ_HOME")]),s._v("/conf/2m-2s-sync/broker-a-s.properties "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_3-启动-broker-b-的主从两台服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动-broker-b-的主从两台服务器"}},[s._v("#")]),s._v(" 3. 启动 broker b 的主从两台服务器")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709150333945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"b"}})]),s._v(" "),e("p",[e("strong",[s._v("在服务器2上启动 broker b 主服务器")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.64.151:9876;192.168.64.152:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-c "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROCKETMQ_HOME")]),s._v("/conf/2m-2s-sync/broker-b.properties "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("在服务器1上启动 broker b 从服务器")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.64.151:9876;192.168.64.152:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-c "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROCKETMQ_HOME")]),s._v("/conf/2m-2s-sync/broker-b-s.properties "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"检查启动的服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查启动的服务"}},[s._v("#")]),s._v(" 检查启动的服务")]),s._v(" "),e("p",[s._v("在两台服务器上分别查看java进程，确认两台服务器上是否各启动了三个java进程，分别运行name server和两个broker。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 java 进程")]),s._v("\njps \n\n---------------------\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12081")]),s._v(" NamesrvStartup\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15745")]),s._v(" BrokerStartup\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15595")]),s._v(" BrokerStartup\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16655")]),s._v(" Jps\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"启动管理界面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动管理界面"}},[s._v("#")]),s._v(" 启动管理界面")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 rocketmq-console 项目打包文件目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/rocketmq/RocketMQ-Externals/rocketmq-console/target/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动管理界面")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" java -jar rocketmq-console-ng-1.0.1.jar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--server.port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--rocketmq.config.namesrvAddr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.64.151:9876;192.168.64.152:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("查看集群状态")]),s._v("：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200709172705572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"在这里插入图片描述"}})]),s._v(" "),e("h2",{attrs:{id:"topic-基本原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#topic-基本原理"}},[s._v("#")]),s._v(" Topic 基本原理")]),s._v(" "),e("h3",{attrs:{id:"在rocketmq集群中新建-topic1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在rocketmq集群中新建-topic1"}},[s._v("#")]),s._v(" 在Rocketmq集群中新建 Topic1")]),s._v(" "),e("p",[s._v("在管理界面中新建"),e("strong",[s._v("主题")]),e("code",[s._v("Topic1")]),s._v("，为了方便观察测试效果，这里把"),e("strong",[s._v("写队列")]),s._v("和"),e("strong",[s._v("读队列")]),s._v("的数量都设置成3。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200711002829639.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"topic1"}})]),s._v(" "),e("p",[s._v("这样，在 broker-a 和 broker-b 上都创建了 Topic1 主题，并各创建了3写3读队列，共6写6读，如下图所示：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200711002512809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"topic1"}})]),s._v(" "),e("p",[e("em",[s._v("你也可以修改Topic1分别配置 broker-a 和 borker-b 上的队列数量。")])]),s._v(" "),e("h3",{attrs:{id:"perm-参数的含义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#perm-参数的含义"}},[s._v("#")]),s._v(" perm 参数的含义")]),s._v(" "),e("p",[e("code",[s._v("perm")]),s._v(" 参数是设置队列的读写权限，下面表格列出了可配置的值及其含义：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("取值")]),s._v(" "),e("th",[s._v("含义")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("6")]),s._v(" "),e("td",[s._v("同时开启读写")])]),s._v(" "),e("tr",[e("td",[s._v("4")]),s._v(" "),e("td",[s._v("禁写")])]),s._v(" "),e("tr",[e("td",[s._v("2")]),s._v(" "),e("td",[s._v("禁读")])])])]),s._v(" "),e("h3",{attrs:{id:"topic-收发消息原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#topic-收发消息原理"}},[s._v("#")]),s._v(" Topic 收发消息原理")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200711143824268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"topic"}})]),s._v(" "),e("p",[s._v("生产者将消息发送到 Topic1 的其中一个"),e("strong",[s._v("写队列")]),s._v("，消费者从对应的一个"),e("strong",[s._v("读队列")]),s._v("接收消息。")]),s._v(" "),e("h3",{attrs:{id:"生产者的负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生产者的负载均衡"}},[s._v("#")]),s._v(" 生产者的负载均衡")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200711153533541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"producer"}})]),s._v(" "),e("p",[s._v("生产者以"),e("strong",[s._v("轮询")]),s._v("的方式向所有写队列发送消息，这些队列可能会分布在多个broker实例上。")]),s._v(" "),e("h3",{attrs:{id:"消费者的负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消费者的负载均衡"}},[s._v("#")]),s._v(" 消费者的负载均衡")]),s._v(" "),e("p",[s._v("一个 group 中的多个消费者，可以以负载均衡的方式来接收消息。")]),s._v(" "),e("p",[e("code",[s._v("读取队列")]),s._v("被均匀分配给这些消费者，它们从指定的队列来接收消息。队列的分配可以采用不同的策略，这里简略介绍以下三种策略：")]),s._v(" "),e("h4",{attrs:{id:"allocatemessagequeueaveragely-平均分配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#allocatemessagequeueaveragely-平均分配"}},[s._v("#")]),s._v(" AllocateMessageQueueAveragely 平均分配")]),s._v(" "),e("p",[s._v("这是默认策略，它是这样分配队列的：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200713225310740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"topic"}})]),s._v(" "),e("h4",{attrs:{id:"allocatemessagequeueaveragelybycircle-环形分配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#allocatemessagequeueaveragelybycircle-环形分配"}},[s._v("#")]),s._v(" AllocateMessageQueueAveragelyByCircle 环形分配")]),s._v(" "),e("p",[s._v("如果使用环形分配，在消费者的代码中需要设置分配策略，代码如下：")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[s._v("consumer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAllocateMessageQueueStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AllocateMessageQueueAveragelyByCircle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这种分配策略的逻辑很简单，所有0号队列分给0号消费者，所有1号队列分给1号消费者，以此类推。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200713225823999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODMwNTQ0MA==,size_16,color_FFFFFF,t_70#pic_center",alt:"topic"}})]),s._v(" "),e("h4",{attrs:{id:"allocatemessagequeueconsistenthash-一致性哈希"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#allocatemessagequeueconsistenthash-一致性哈希"}},[s._v("#")]),s._v(" AllocateMessageQueueConsistentHash 一致性哈希")]),s._v(" "),e("p",[s._v("如果使用一致性哈希算法进行分配，在消费者的代码中需要设置分配策略，代码如下：")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[s._v("consumer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAllocateMessageQueueStrategy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AllocateMessageQueueConsistentHash")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这种算法依靠一致性哈希算法，看当前消费者可以落到哪个虚拟节点，该虚拟节点对应哪个队列。")]),s._v(" "),e("h3",{attrs:{id:"问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),e("p",[s._v("思考一下，如果写队列比读队列多会怎样？反之会怎样？")]),s._v(" "),e("h2",{attrs:{id:"nameserver-基本原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nameserver-基本原理"}},[s._v("#")]),s._v(" NameServer 基本原理")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200713233623258.png#pic_center",alt:"rocketmq"}})]),s._v(" "),e("p",[s._v("NameServer 是 rocketmq 自己开发的一个轻型注册中心，他的作用相当于是 zk、eureka等。")]),s._v(" "),e("p",[s._v("rocketmq 为什么不使用 zk 呢？实际上 rocketmq 的早期版本使用的就是 zookeeper。")]),s._v(" "),e("p",[s._v("而 rocketmq 的架构设计决定了只需要一个轻量级的元数据服务器就足够了。杀鸡焉用牛刀？小区里，搞个货架就行了，建个仓库，又占地方，维护成本又高。")]),s._v(" "),e("p",[s._v("甚至，NameServer 都不需要有一个集群的管理者。以至于，NameServer 看起来都不像一个集群。事实上，NameServer 本质上来看，也不是一个集群。因为它的各个节点是独立的，不相关的。每个 NameServer 都是独立和 Producer、Consumer打交道。")]),s._v(" "),e("h3",{attrs:{id:"基本认识"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本认识"}},[s._v("#")]),s._v(" 基本认识")]),s._v(" "),e("ol",[e("li",[s._v("NameServer主要用于存储Topic，Broker关系信息，功能简单，稳定性高。")]),s._v(" "),e("li",[s._v("各个NameServer节点之间不相关，不需要通信，单台宕机不影响其它节点。")]),s._v(" "),e("li",[s._v("NameServer集群整体宕机不影响已建立关系的Concumer，Producer，Broker。")])]),s._v(" "),e("h3",{attrs:{id:"broker、producer、consumer-与nameserver的通信"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#broker、producer、consumer-与nameserver的通信"}},[s._v("#")]),s._v(" Broker、Producer、Consumer 与NameServer的通信")]),s._v(" "),e("ol",[e("li",[s._v("每个Borker和所有NameServer保持长连接，心跳间隔为30秒。每次心跳时还会携带当前的Topic信息。当某个Broker两分钟之内没有心跳，则认为该Broker下线，并调整内存中与该Broker相关的Topic信息。")]),s._v(" "),e("li",[s._v("Consumer 从 NameServer 获得 Topic 的路由信息，与对应的 Broker 建立长连接。间隔30秒发送心跳至Broker。Broker检查若发现某 Consumer 两分钟内无心跳则认为该Consumer下线，并通知该Consumer所有的消费者集群中的其他实例，触发该消费者集群重新负载均衡。")]),s._v(" "),e("li",[s._v("Producer 与消费者一样，也是从 NameServer 获得 Topic 的路由信息，与对应的 Broker 建立长连接，30秒发送一次心跳。Broker 也会认为两分钟内没有心跳的 Producer 下线。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);