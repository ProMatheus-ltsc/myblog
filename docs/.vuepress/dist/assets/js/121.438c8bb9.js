(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{1440:function(t,s,a){"use strict";a.r(s);var e=a(65),v=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql本地事务和事务隔离级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql本地事务和事务隔离级别"}},[t._v("#")]),t._v(" MySQL本地事务和事务隔离级别")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#数据库事务"}},[t._v("数据库事务")])]),a("li",[a("a",{attrs:{href:"#mysql-事务操作"}},[t._v("Mysql 事务操作")]),a("ul",[a("li",[a("a",{attrs:{href:"#开始事务"}},[t._v("开始事务")])]),a("li",[a("a",{attrs:{href:"#提交事务"}},[t._v("提交事务")])]),a("li",[a("a",{attrs:{href:"#回滚事务"}},[t._v("回滚事务")])]),a("li",[a("a",{attrs:{href:"#mysql-事务操作测试"}},[t._v("Mysql 事务操作测试")])])])]),a("li",[a("a",{attrs:{href:"#事务特性-acid"}},[t._v("事务特性 ACID")]),a("ul",[a("li",[a("a",{attrs:{href:"#a-原子性-atomic"}},[t._v("A - 原子性 Atomic")])]),a("li",[a("a",{attrs:{href:"#c-一致性-consistency"}},[t._v("C - 一致性 Consistency")])]),a("li",[a("a",{attrs:{href:"#i-隔离性-isolation"}},[t._v("I - 隔离性 Isolation")])]),a("li",[a("a",{attrs:{href:"#d-持久性-durancy"}},[t._v("D - 持久性 Durancy")])])])]),a("li",[a("a",{attrs:{href:"#数据库并发访问冲突问题"}},[t._v("数据库并发访问冲突问题")]),a("ul",[a("li",[a("a",{attrs:{href:"#脏读"}},[t._v("脏读")])]),a("li",[a("a",{attrs:{href:"#不可重复读"}},[t._v("不可重复读")])]),a("li",[a("a",{attrs:{href:"#幻读"}},[t._v("幻读")])])])]),a("li",[a("a",{attrs:{href:"#mysql-的四种事务隔离级别"}},[t._v("Mysql 的四种事务隔离级别")]),a("ul",[a("li",[a("a",{attrs:{href:"#mysql-设置隔离级别"}},[t._v("Mysql 设置隔离级别")])]),a("li",[a("a",{attrs:{href:"#mysql-隔离级别测试"}},[t._v("Mysql 隔离级别测试")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"数据库事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库事务"}},[t._v("#")]),t._v(" 数据库事务")]),t._v(" "),a("p",[t._v("数据库事务由一组sql语句组成。")]),t._v(" "),a("p",[t._v("所有sql语句执行成功则事务整体成功；任一条sql语句失败则事务整体失败，数据恢复到事务之前的状态。")]),t._v(" "),a("p",[t._v("下面以转账为例进一步说明。")]),t._v(" "),a("p",[t._v("A 账户向 B 账户转账，需要更新两个账户的记录：")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" A 账户减金额\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" money"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("money"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'A'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" B 账户加金额\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" money"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("money"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'B'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("ul",[a("li",[t._v("两条sql语句都成功则转账成功。")]),t._v(" "),a("li",[t._v("任意一条sql语句失败，恢复以前的状态。")])]),t._v(" "),a("p",[a("strong",[t._v("数据操作的最小单元是事务，而不是一条sql语句！")])]),t._v(" "),a("h2",{attrs:{id:"mysql-事务操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-事务操作"}},[t._v("#")]),t._v(" Mysql 事务操作")]),t._v(" "),a("h3",{attrs:{id:"开始事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始事务"}},[t._v("#")]),t._v(" 开始事务")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("start")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("transaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 或\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("begin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("事务开始后，对数据的增删改操作不直接修改数据表，而是被记录在日志文件中。")]),t._v(" "),a("h3",{attrs:{id:"提交事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提交事务"}},[t._v("#")]),t._v(" 提交事务")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("将日志中记录的操作，永久保存到数据表，并清空日志文件。")]),t._v(" "),a("h3",{attrs:{id:"回滚事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚事务"}},[t._v("#")]),t._v(" 回滚事务")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rollback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("直接清空日志文件")]),t._v(" "),a("h3",{attrs:{id:"mysql-事务操作测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-事务操作测试"}},[t._v("#")]),t._v(" Mysql 事务操作测试")]),t._v(" "),a("h4",{attrs:{id:"_1-准备测试表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备测试表"}},[t._v("#")]),t._v(" 1.准备测试表")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tusername "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VARCHAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 插入一条数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h4",{attrs:{id:"_2-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-测试"}},[t._v("#")]),t._v(" 2. 测试")]),t._v(" "),a("p",[t._v("打开"),a("strong",[t._v("两个")]),t._v("终端，分别登录数据库。")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在终端登录 mysql")]),t._v("\nmysql -uroot -p\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换到你的数据库")]),t._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" use 数据库名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("strong",[t._v("测试一")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("终端A")]),t._v(" "),a("th",[t._v("终端B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[a("code",[t._v("begin;")])]),t._v(" "),a("td",[a("code",[t._v("begin;")])])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[a("code",[t._v("insert into user(username) values('A');")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[a("code",[t._v("update user set username='X' where id=1;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" B查询不到A未提交的数据")])]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" A未提交的数据对于自己是可见的")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td",[a("code",[t._v("commit;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 即使A已经提交，B也查询不到A提交的数据")])]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("commit;")])])]),t._v(" "),a("tr",[a("td",[t._v("9")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" B的事务结束后才能查询到A提交的数据")])])])]),t._v(" "),a("p",[a("strong",[t._v("测试二")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("终端A")]),t._v(" "),a("th",[t._v("终端B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[a("code",[t._v("rollback;")]),t._v(" 为避免未结束的事务影响，先结束前面的事务")]),t._v(" "),a("td",[a("code",[t._v("rollback;")]),t._v(" 为避免未结束的事务影响，先结束前面的事务")])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[a("code",[t._v("begin;")])]),t._v(" "),a("td",[a("code",[t._v("begin;")])])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[a("code",[t._v("insert into user(username) values('B');")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[a("code",[t._v("update user set username='Y' where id=1;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td",[a("code",[t._v("commit;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")])])]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("insert into user(username) values('C');")])])]),t._v(" "),a("tr",[a("td",[t._v("9")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("update user set username='Z' where id=1;")])])]),t._v(" "),a("tr",[a("td",[t._v("10")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")])])]),t._v(" "),a("tr",[a("td",[t._v("11")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("rollback;")]),t._v(" 回滚事务，B的数据修改全部丢弃，恢复到以前的状态。"),a("strong",[t._v("注意自增主键不会回滚")])])]),t._v(" "),a("tr",[a("td",[t._v("12")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")])])])])]),t._v(" "),a("h2",{attrs:{id:"事务特性-acid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务特性-acid"}},[t._v("#")]),t._v(" 事务特性 ACID")]),t._v(" "),a("h3",{attrs:{id:"a-原子性-atomic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#a-原子性-atomic"}},[t._v("#")]),t._v(" A - 原子性 Atomic")]),t._v(" "),a("p",[t._v("一个事务是一个不可分割的工作单元，事务中包括的操作要么都做，要么都不做。")]),t._v(" "),a("p",[t._v("数据操作的最小单元是事务，而不是SQL语句 。")]),t._v(" "),a("h3",{attrs:{id:"c-一致性-consistency"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c-一致性-consistency"}},[t._v("#")]),t._v(" C - 一致性 Consistency")]),t._v(" "),a("p",[t._v("事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。")]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("ul",[a("li",[t._v("转账前 a+b = 100")]),t._v(" "),a("li",[t._v("转帐后 a+b = 100")])]),t._v(" "),a("h3",{attrs:{id:"i-隔离性-isolation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-隔离性-isolation"}},[t._v("#")]),t._v(" I - 隔离性 Isolation")]),t._v(" "),a("p",[t._v("一个事务的执行不能被其他事务干扰。")]),t._v(" "),a("p",[t._v("即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。")]),t._v(" "),a("h3",{attrs:{id:"d-持久性-durancy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#d-持久性-durancy"}},[t._v("#")]),t._v(" D - 持久性 Durancy")]),t._v(" "),a("p",[t._v("一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。")]),t._v(" "),a("h2",{attrs:{id:"数据库并发访问冲突问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库并发访问冲突问题"}},[t._v("#")]),t._v(" 数据库并发访问冲突问题")]),t._v(" "),a("h3",{attrs:{id:"脏读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脏读"}},[t._v("#")]),t._v(" 脏读")]),t._v(" "),a("p",[t._v("读取到其他事务未提交的数据。")]),t._v(" "),a("h3",{attrs:{id:"不可重复读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不可重复读"}},[t._v("#")]),t._v(" 不可重复读")]),t._v(" "),a("ul",[a("li",[t._v("重复读取同一数据时，与之前读取的数据不一致。")]),t._v(" "),a("li",[t._v("一个事务提交的数据，可以被另一个事务立即读取。")])]),t._v(" "),a("h3",{attrs:{id:"幻读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#幻读"}},[t._v("#")]),t._v(" 幻读")]),t._v(" "),a("ul",[a("li",[t._v("读取到已经被删除的数据。")]),t._v(" "),a("li",[t._v("读取不到新插入的数据。")])]),t._v(" "),a("h2",{attrs:{id:"mysql-的四种事务隔离级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-的四种事务隔离级别"}},[t._v("#")]),t._v(" Mysql 的四种事务隔离级别")]),t._v(" "),a("p",[t._v("事务之间为了避免互相干扰，执行时要进行隔离。也就是A执行时B要等待。但严格的隔离会造成性能的下降。")]),t._v(" "),a("p",[t._v("数据库为了兼顾数据安全和性能，可以在一定程度上允许多个事务并行执行。")]),t._v(" "),a("p",[t._v("Mysql 提供了四种隔离级别从低到高：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("READ-UNCOMMITTED")])]),t._v(" "),a("li",[a("code",[t._v("READ-COMMITTED")])]),t._v(" "),a("li",[a("code",[t._v("REPEATABLE-READ")])]),t._v(" "),a("li",[a("code",[t._v("SERIALIZABLE")])])]),t._v(" "),a("p",[t._v("隔离级别越高数据越安全；越低性能越好，但会造成数据访问的问题：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("可能引发的问题")]),t._v(" "),a("th",[a("code",[t._v("READ-UNCOMMITTED")])]),t._v(" "),a("th",[a("code",[t._v("READ-COMMITTED")])]),t._v(" "),a("th",[a("code",[t._v("REPEATABLE-READ")])]),t._v(" "),a("th",[a("code",[t._v("SERIALIZABLE")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("幻读")]),t._v(" "),a("td",[a("code",[t._v("√")])]),t._v(" "),a("td",[a("code",[t._v("√")])]),t._v(" "),a("td",[a("code",[t._v("√")])]),t._v(" "),a("td",[t._v("×")])]),t._v(" "),a("tr",[a("td",[t._v("不可重复读")]),t._v(" "),a("td",[a("code",[t._v("√")])]),t._v(" "),a("td",[a("code",[t._v("√")])]),t._v(" "),a("td",[t._v("×")]),t._v(" "),a("td",[t._v("×")])]),t._v(" "),a("tr",[a("td",[t._v("脏读")]),t._v(" "),a("td",[a("code",[t._v("√")])]),t._v(" "),a("td",[t._v("×")]),t._v(" "),a("td",[t._v("×")]),t._v(" "),a("td",[t._v("×")])])])]),t._v(" "),a("h3",{attrs:{id:"mysql-设置隔离级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-设置隔离级别"}},[t._v("#")]),t._v(" Mysql 设置隔离级别")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" tx_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'read-uncommitted'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" tx_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'read-committed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# repeatable-read 是Mysql默认的隔离级别")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" tx_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repeatable-read'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" tx_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'serializable'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("oracle mysql 8 使用 "),a("code",[t._v("transaction_isolation")]),t._v(" 系统变量：")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" transaction_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'read-uncommitted'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" transaction_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'read-committed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# repeatable-read 是Mysql默认的隔离级别")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" transaction_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repeatable-read'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" transaction_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'serializable'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[t._v("注意：")]),a("code",[t._v("set")]),t._v("设置的变量只对当前会话有效。需要进行全局设置使用 "),a("code",[t._v("set global")])]),t._v(" "),a("h3",{attrs:{id:"mysql-隔离级别测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-隔离级别测试"}},[t._v("#")]),t._v(" Mysql 隔离级别测试")]),t._v(" "),a("p",[t._v("打开"),a("strong",[t._v("两个")]),t._v("终端，分别登录数据库。")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在终端登录 mysql")]),t._v("\nmysql -uroot -p\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换到你的数据库")]),t._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" use 数据库名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("strong",[t._v("测试一")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("终端A")]),t._v(" "),a("th",[t._v("终端B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[a("code",[t._v("set tx_isolation='read-uncommitted';")])]),t._v(" "),a("td",[a("code",[t._v("set tx_isolation='read-uncommitted';")])])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[a("code",[t._v("rollback;")])]),t._v(" "),a("td",[a("code",[t._v("rollback;")])])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[a("code",[t._v("begin;")])]),t._v(" "),a("td",[a("code",[t._v("begin;")])])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[a("code",[t._v("insert into user(username) values('D');")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[a("code",[t._v("update user set username='R' where id=1;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 可以读取A未提交的数据，这些数据在真实数据表中并不存在")])]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td",[a("code",[t._v("rollback;")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td"),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" A回滚后，B不能再重复读取这些数据")])])])]),t._v(" "),a("p",[a("strong",[t._v("测试二")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("终端A")]),t._v(" "),a("th",[t._v("终端B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[a("code",[t._v("set tx_isolation='read-committed';")])]),t._v(" "),a("td",[a("code",[t._v("set tx_isolation='read-committed';")])])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[a("code",[t._v("rollback;")])]),t._v(" "),a("td",[a("code",[t._v("rollback;")])])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[a("code",[t._v("begin;")])]),t._v(" "),a("td",[a("code",[t._v("begin;")])])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")])])]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[a("code",[t._v("insert into user(username) values('E');")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td",[a("code",[t._v("update user set username='S' where id=1;")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 不能读取A未提交的数据")])]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td",[a("code",[t._v("commit;")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("9")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" A提交后，可以立即读取")])])])]),t._v(" "),a("p",[a("strong",[t._v("测试三")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("终端A")]),t._v(" "),a("th",[t._v("终端B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[a("code",[t._v("set tx_isolation='repeatable-read';")])]),t._v(" "),a("td",[a("code",[t._v("set tx_isolation='repeatable-read';")])])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[a("code",[t._v("rollback;")])]),t._v(" "),a("td",[a("code",[t._v("rollback;")])])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[a("code",[t._v("begin;")])]),t._v(" "),a("td",[a("code",[t._v("begin;")])])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")])])]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[a("code",[t._v("insert into user(username) values('F');")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td",[a("code",[t._v("update user set username='T' where id=1;")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td",[a("code",[t._v("commit;")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 即使A已经提交，这里也不能读取A已提交的数据。这里读取的结果要和前一次的结果一致")])]),t._v(" "),a("tr",[a("td",[t._v("9")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("update user set password='111';")]),t._v(" 可以修改A已提交的数据")])]),t._v(" "),a("tr",[a("td",[t._v("10")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 修改后这些数据又变成可见的")])])])]),t._v(" "),a("p",[a("strong",[t._v("测试四")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("终端A")]),t._v(" "),a("th",[t._v("终端B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[a("code",[t._v("rollback;")])]),t._v(" "),a("td",[a("code",[t._v("rollback;")])])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[a("code",[t._v("begin;")])]),t._v(" "),a("td",[a("code",[t._v("begin;")])])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")])])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[a("code",[t._v("delete from user where id<5;")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[a("code",[t._v("commit;")])]),t._v(" "),a("td",[t._v("``")])]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 仍然可以查询到已被A删除的数据")])]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("update user set password='222';")]),t._v(" 但是不可能去修改这些已删除的数据")])]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 现在被删掉的数据还是可见的")])]),t._v(" "),a("tr",[a("td",[t._v("9")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("commit;")])])]),t._v(" "),a("tr",[a("td",[t._v("10")]),t._v(" "),a("td",[t._v("``")]),t._v(" "),a("td",[a("code",[t._v("select * from user;")]),t._v(" 事务结束后这些数据不再可见")])])])])])}),[],!1,null,null,null);s.default=v.exports}}]);